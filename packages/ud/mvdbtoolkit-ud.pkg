01893FMVDBTOOLKIT.BPþ0c00056D1MVDBTOOLKIT.TESTþ0c2      PRINT @(-1):"MVDBTOOLKIT.TEST"þ      PRINTþþ      INCLUDE MVDBTOOLKIT.TEST.INCLUDEþþ      INCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþþ      TEST.PLATFORM=FIELD(CMND,' ',2)þ      TEST.MVTYPE=FIELD(CMND,' ',3)þþ      CALL MVDBTOOLKIT.WPLATFORM(PLATFORM.OBJ)þþ      IF TEST.PLATFORM = "" THENþ         CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","platform",TEST.PLATFORM,"",RERR)þ      ENDþ      IF TEST.MVTYPE = "" THENþ         CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","mvtype",TEST.MVTYPE,"",RERR)þ      ENDþþ      IF TEST.PLATFORM = "" THENþ         PRINT "Enter Platform: ":; INPUT TEST.PLATFORMþ      ENDþþ      IF TEST.MVTYPE = "" THENþ         PRINT "Enter MVType: ":; INPUT TEST.MVTYPEþ      ENDþþ      IF TEST.PLATFORM='' OR TEST.MVTYPE='' THENþ         PRINT "Usage: MVDBTOOLKIT PLATFORM MVTYPE"þ         PRINTþ         PRINT "PLATFORM=WINDOWS or LINUX"þ         PRINT "MVTYPE=JBASE,D3,UNIVERSE,UNIDATA"þ         STOPþ      ENDþþ      * GET ENVIRONMENTþ      CALL MVDBTOOLKIT.WPLATFORM(PLATFORM.OBJ)þþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","curllocation",CURLLOCATION,"",RERR)þþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","platform",PLATFORM,"",RERR)þ      TEST='platform'; GOSUB start.testþ      TEST.MSG=PLATFORM:"=":TEST.PLATFORMþ      IF PLATFORM # TEST.PLATFORM THEN TEST.STATUS=0 ELSE TEST.STATUS=1þ      GOSUB end.testþþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","mvtype",RESULT,"",RERR)þþþ      TEST='mvtype'; GOSUB start.testþ      TEST.MSG=RESULT:"=":TEST.MVTYPEþ      IF RESULT # TEST.MVTYPE THEN TEST.STATUS=0 ELSE TEST.STATUS=1þ      GOSUB end.testþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","tmpdir",TMP.DIR,"",RERR)þ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","filedelim",FILEDELIM,"",RERR)þþ      TEST='filedelim'; GOSUB start.testþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","filedelim",FILEDELIM,"",RERR)þ      TEST.MSG=FILEDELIMþ      TEST.STATUS=1þ      BEGIN CASEþ         CASE OCONV(PLATFORM,"MCU") = "LINUX" AND FILEDELIM="/"þ         CASE OCONV(PLATFORM,"MCU") = "WINDOWS" AND FILEDELIM="\"þ         CASE 1; TEST.STATUS=0þ      END CASEþ      GOSUB end.testþþ      TEST='tmpdir'; GOSUB start.testþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","tmpdir",TMP.DIR,"",RERR)þ      TEST.MSG=TMP.DIRþ      TEST.STATUS=1þ      IF TMP.DIR="" THEN TEST.STATUS=0þ      GOSUB end.testþþþ      TEST='MVDBTOOLKIT.SWAP'þ      GOSUB start.testþ      S='TEST LINE TEST LINE'þ      ORIG.STRING=Sþ      CALL MVDBTOOLKIT.SWAP(S,"ES","XX")þ      IF S = "TXXT LINE TXXT LINE" THEN TEST.STATUS=1 ELSE TEST.STATUS=0þ      TEST.MSG=Sþ      GOSUB end.testþþ      * Test 1 Getenvþþ      TEST="getenv"þ      GOSUB start.testþ      CALL MVDBTOOLKIT.WGETENV("PATH",PATH)þ      IF PATH # "" THENþ         TEST.MSG=PATH[1,60]þ         TEST.STATUS=1þ      END ELSEþ         TEST.MSG=""þ         TEST.STATUS=0þ      ENDþ      GOSUB end.testþþ      * Test WEXECUTEþþ      TEST="wexecute"; GOSUB start.testþ      CMND='echo MVDBTOOLKIT.TEST'þþ      CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ      CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ      CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ      IF INDEX(CMND.RESULT,"MVDBTOOLKIT.TEST",1) THENþ         TEST.MSG=CMND.RESULTþ         TEST.STATUS=1þ      END ELSEþ         TEST.MSG=CMND.RESULTþ         TEST.STATUS=0þ      ENDþ      CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ      GOSUB end.testþþþþþ      * Test WFILEIO **********************************************************************þþ      ** UNIX AS TEST DATAþ      NEWLINE.INS='UNIX':@AM:'DOS':@AM:'MV':@AM:'RAW'þ      NEWLINE.OUTS='UNIX':@AM:'DOS':@AM:'MV':@AM:'RAW'þ      NEWLINE.DELS='UNIX':@AM:'DOS':@AM:'MV'þþþ      *NEWLINE.INS='UNIX'þ      *NEWLINE.OUTS='MV'þþ      NUM.NEWLINES.INS = DCOUNT(NEWLINE.INS,@AM)þ      NUM.NEWLINES.OUTS = DCOUNT(NEWLINE.OUTS,@AM)þ      NUM.NEWLINES.DELS=DCOUNT(NEWLINE.DELS,@AM)þ      NUM.COMBINATIONS=0þ      FOR NUM.NEWLINES.INS.CNTR = 1 TO NUM.NEWLINES.INSþ         FOR NUM.NEWLINES.OUTS.CNTR = 1 TO NUM.NEWLINES.OUTSþ            FOR NUM.NEWLINES.DELS.CNTR = 1 TO NUM.NEWLINES.DELSþ               NEWLINE.IN=NEWLINE.INS<NUM.NEWLINES.INS.CNTR>þ               NEWLINE.OUT=NEWLINE.OUTS<NUM.NEWLINES.OUTS.CNTR>þ               TMP.NEWLINE.DEL=NEWLINE.DELS<NUM.NEWLINES.DELS.CNTR>þ               BEGIN CASEþ                  CASE TMP.NEWLINE.DEL='UNIX'; NEWLINE.DEL=CHAR(10)þ                  CASE TMP.NEWLINE.DEL='DOS'; NEWLINE.DEL=CHAR(13):CHAR(10)þ                  CASE TMP.NEWLINE.DEL='MV'; NEWLINE.DEL=CHAR(254)þ                  CASE 1; NEWLINE.DEL=CHAR(254)þ               END CASEþ               *NEWLINE.D=OCONV(TIME(),'MTS')þ               *NEWDATA.IN=NEWLINE.D:CHAR(254):'LINE2'þ               *NEWDATA.RAW=NEWLINE.D:CHAR(10):'LINE2'þ               *NEWDATA.OUT=NEWLINE.D:CHAR(10):'LINE2'þ               NUM.COMBINATIONS+=1þ               GOSUB fileiotestþ            NEXT NUM.NEWLINES.DELS.CNTRþ         NEXT NUM.NEWLINES.OUTS.CNTRþ      NEXT NUM.NEWLINES.INSþþ      PRINT 'Number of combinations: ':NUM.COMBINATIONSþþ      * Let get our current directoryþ      TEST="pwd"; GOSUB start.testþ      IF OCONV(PLATFORM,"MCU") = "WINDOWS" THENþ         CMND='echo %CD%'þ      END ELSEþ         CMND='pwd'þ      ENDþþ      CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ      CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ      CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ      IF 1 THENþ         TEST.MSG=CMND.RESULTþ         TEST.STATUS=1þ      END ELSEþ         TEST.MSG=CMND.RESULTþ         TEST.STATUS=0þ      ENDþ      CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ      GOSUB end.testþþ      MVDBTOOLKIT.LOCATION = CMND.RESULTþþ      IF 0 THENþ         * Lets verify we have curl!!!þ         IF CURLLOCATION="" THEN CURLLOCATION="curl"þþ         TEST="default curl"; GOSUB start.testþ         CMND=CURLLOCATION:' -V'þþ         CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ         CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ         CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ         CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ         BEGIN CASEþ            CASE INDEX(CMND.RESULT,"libcurl",1) AND 0þ               TEST.MSG=CMND.RESULTþ               TEST.STATUS=1þ            CASE OCONV(PLATFORM,"MCU")="WINDOWS"þ               TEST.MSG=CMND.RESULTþ               TEST.STATUS=2þ            CASE 1þ               TEST.MSG=0þ         END CASEþþ         CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ         GOSUB end.testþþ         * Start looking for curlþ         IF TEST.STATUS=2 THENþ            CURLLOCATION="c:\progra~1\git\mingw64\bin\curl.exe"þ            TEST="git curl"; GOSUB start.testþ            CMND=CURLLOCATION:' -V'þþ            CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ            CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ            CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ            CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ            BEGIN CASEþ               CASE INDEX(CMND.RESULT,"libcurl",1) AND 0þ                  TEST.MSG=CMND.RESULTþ                  TEST.STATUS=1þ               CASE OCONV(PLATFORM,"MCU")="WINDOWS"þ                  TEST.MSG=CMND.RESULTþ                  TEST.STATUS=2þ               CASE 1þ                  TEST.MSG=CMND.RESULTþ                  TEST.STATUS=0þ            END CASEþþ            CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ            GOSUB end.testþ         ENDþþ         IF TEST.STATUS=2 THENþ            CURLLOCATION=MVDBTOOLKIT.LOCATION:"\mvdbtoolkit\curl\windows64\curl.exe"þ            TEST="mvdbtoolkit curl"; GOSUB start.testþ            CMND=CURLLOCATION:' -V'þþ            CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ            CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ            CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ            CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ            BEGIN CASEþ               CASE INDEX(CMND.RESULT,"libcurl",1) AND 0þ                  TEST.MSG=CMND.RESULTþ                  TEST.STATUS=1þ               CASE 1þ                  TEST.STATUS=0þ                  TEST.MSG=CMNDþþ            END CASEþþ            CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ            GOSUB end.testþ         ENDþ      ENDþþ      TEST="WCALL"þ      GOSUB start.testþþ      CALL @WOBJ.RTNE(OBJ,"FROMSTRING","","{}","",RERR)þþ      CALL @WOBJ.RTNE(OBJ,"SET","method","POST","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","debug","N","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","url","https://httpbin.org/anything?field1=value1","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","insecure","Y","",RERR)þþ      CALL @WOBJ.RTNE(OBJ,"SET.OBJECT","headers","{}","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","headers.X-TEST-HEADER","headertest","",RERR)þþ      CALL @WOBJ.RTNE(OBJ,"SET.ARRAY","formfields","[]","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET.OBJECT","formfields[-1]","{}","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","formfields[0].name","field2","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","formfields[0].value","VALUE2$","",RERR)þþ      CALL @WOBJ.RTNE(SOBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(SOBJ,"SET","name","field3","",RERR)þ      CALL @WOBJ.RTNE(SOBJ,"SET","value","<EXAMPLE HTML>","",RERR)þ      CALL @WOBJ.RTNE(SOBJ,"TOSTRING","",SJSON,"",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET.OBJECT","formfields[-1]",SJSON,"",RERR)þþ      CALL MVDBTOOLKIT.WCALL(OBJ)þþ      CALL @WOBJ.RTNE(OBJ,"GET","response.data",RESPONSE,"",RERR)þ      *OPEN "MVDBTOOLKIT.BP" TO FILE ELSE STOPþ      *PRINT "RESPONSE=":RESPONSEþ      * WRITE RESPONSE ON FILE, "MVDBTOOLKIT.TEST.JSON"þ      CALL @WOBJ.RTNE(OBJ,"TOSTRING","",OUT.JSON,"PRETTIFY",RERR)þ      * WRITE OUT.JSON ON FILE, "MVDBTOOLKIT.WCALL.JSON"þþþ      CALL @WOBJ.RTNE(OBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þ      *PRINT 'RESPONSE.STATUS=':RESPONSE.STATUS:'  ':þ      *IF RESPONSE.STATUS="200" THEN PRINT "OK" ELSE PRINT "FAIL"þ      TEST.MSG=RESPONSE.STATUSþ      IF RESPONSE.STATUS="200" THENþ         TEST.STATUS=1þ      END ELSEþ         TEST.STATUS=0þ      ENDþ      GOSUB end.testþþ      TEST='WCALL.HTTPTYPE'þ      GOSUB start.testþ      CALL @WOBJ.RTNE(OBJ,"GET","response.http_type",RESPONSE.HTTP.TYPE,"",RERR)þ      *PRINT 'RESPONSE.HTTP_TYPE=':RESPONSE.HTTP.TYPEþ      TEST.MSG=RESPONSE.HTTP.TYPEþ      IF INDEX(TEST.MSG,'HTTP/',1) THENþ         TEST.STATUS=1þ      END ELSEþ         TEST.STATUS=0þ      ENDþ      GOSUB end.testþ      CALL @WOBJ.RTNE(ROBJ,"FROMSTRING","",RESPONSE,"",RERR)þþ      TEST="WCALL.FIELD1"þ      GOSUB start.testþ      CALL @WOBJ.RTNE(ROBJ,"GET","args.field1",VALUE,"",RERR)þ      TEST.MSG=VALUEþ      IF TEST.MSG="value1" THEN TEST.STATUS=1 ELSE TEST.STATUS=0þ      GOSUB end.testþþþ      TEST="WCALL.field2"þ      GOSUB start.testþ      CALL @WOBJ.RTNE(ROBJ,"GET","form.field2",VALUE,"",RERR)þ      TEST.MSG=VALUEþ      IF TEST.MSG="VALUE2$" THEN TEST.STATUS=1 ELSE TEST.STATUS=0þ      GOSUB end.testþþ      TEST="WCALL.field3"þ      GOSUB start.testþ      CALL @WOBJ.RTNE(ROBJ,"GET","form.field3",VALUE,"",RERR)þ      TEST.MSG=VALUEþ      IF TEST.MSG="<EXAMPLE HTML>" THEN TEST.STATUS=1 ELSE TEST.STATUS=0þ      GOSUB end.testþþþ      TEST="WCALL.HEADER"þ      GOSUB start.testþ      CALL @WOBJ.RTNE(ROBJ,"GET","headers.X-Test-Header",VALUE,"",RERR)þ      TEST.MSG=VALUEþ      IF TEST.MSG="headertest" THEN TEST.STATUS=1 ELSE TEST.STATUS=0þ      GOSUB end.testþþ      TEST="WCALL.BODY"þ      GOSUB start.testþþ      CALL @WOBJ.RTNE(OBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","method","POST","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","debug","N","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","url","https://httpbin.org/anything?field1=value1","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","insecure","N","",RERR)þþ      CALL @WOBJ.RTNE(OBJ,"SET.OBJECT","headers","{}","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","Content-Type","application/json","",RERR)þþ      CALL @WOBJ.RTNE(TESTOBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(TESTOBJ,"SET","test","value","",RERR)þ      CALL @WOBJ.RTNE(TESTOBJ,"TOSTRING","",TESTJSON,"PRETTIFY",RERR)þþ      CALL @WOBJ.RTNE(OBJ,"SET.STRING","body",TESTJSON,"",RERR)þþ      CALL MVDBTOOLKIT.WCALL(OBJ)þþ      CALL @WOBJ.RTNE(OBJ,"GET","response.data",RESPONSE,"",RERR)þþ      * WRITE RESPONSE ON FILE, "MVDBTOOLKIT.TESTBODY.JSON"þ      CALL @WOBJ.RTNE(OBJ,"TOSTRING","",OUT.JSON,"PRETTIFY",RERR)þ      * WRITE OUT.JSON ON FILE, "MVDBTOOLKIT.WCALLBODY.JSON"þþþ      CALL @WOBJ.RTNE(OBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þ      *PRINT 'RESPONSE.STATUS=':RESPONSE.STATUS:'  ':þ      *IF RESPONSE.STATUS="200" THEN PRINT "OK" ELSE PRINT "FAIL"þ      TEST.MSG=RESPONSE.STATUSþ      IF RESPONSE.STATUS="200" THENþ         TEST.STATUS=1þ      END ELSEþ         TEST.STATUS=0þ      ENDþ      GOSUB end.testþþ      TEST="WCALL.BODY.RESULT"þ      GOSUB start.testþ      * The testing web site does not send raw body back very wellþ      * we will just look for what we expectþ      CONVERT CHAR(254):CHAR(253):CHAR(252):CHAR(10):CHAR(13) TO '' IN RESPONSEþ      POS=INDEX(RESPONSE,'"form"',1)þ      IF POS THEN RESPONSE=RESPONSE[POS,9999]þ      TEST.MSG=RESPONSEþ      IF INDEX(RESPONSE,'"test',1) AND INDEX(RESPONSE,'"value',1) THENþ         TEST.STATUS=1þ      END ELSEþ         TEST.STATUS=0þ      ENDþ      GOSUB end.testþþ      TEST='WCALL Timeout'þ      GOSUB start.testþ      CALL @WOBJ.RTNE(OBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","method","GET","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","debug","N","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","url","https://httpbin.org/delay/3","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","insecure","N","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","timeout",1,"",RERR)þþ      CALL MVDBTOOLKIT.WCALL(OBJ)þ      *     CALL MVDBTOOLKIT.WCALL.DEBUG(OBJ)þþ      CALL @WOBJ.RTNE(OBJ,"GET","response.log",RESPONSE.LOG,"",RERR)þþ      CALL @WOBJ.RTNE(OBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þþ      POS=INDEX(RESPONSE.LOG,"* Operation timed out",1)þþ      IF POS THENþ         TEST.MSG=RESPONSE.LOG[POS,LEN(RESPONSE.LOG)]þ         TEST.MSG=TEST.MSG<1,1,1>þ         TEST.MSG=FIELD(TEST.MSG,CHAR(13),1)þ         TEST.MSG=FIELD(TEST.MSG,CHAR(10),1)þ      END ELSEþ         TEST.MSG=RESPONSE.STATUSþ      ENDþ      IF RESPONSE.STATUS="0" AND INDEX(RESPONSE.LOG,"Operation timed out after",1) THENþ         TEST.STATUS=1þ      END ELSEþ         TEST.STATUS=0þ      ENDþ      GOSUB end.testþþ      TEST='WCALL 100-continue'þ      GOSUB start.testþ      CALL @WOBJ.RTNE(OBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","method","GET","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","debug","N","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","url","https://httpbin.org/anything?f=v","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","insecure","N","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET.OBJECT","headers","{}","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","headers.Expect","100-continue","",RERR)þ      CALL @WOBJ.RTNE(OBJ,"SET","options","--http1.1","",RERR)þþ      CALL MVDBTOOLKIT.WCALL(OBJ)þ      *CALL MVDBTOOLKIT.WCALL.DEBUG(OBJ)þþ      CALL @WOBJ.RTNE(OBJ,"GET","response.log",RESPONSE.LOG,"",RERR)þþ      CALL @WOBJ.RTNE(OBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þþ      CALL WOBJ(OBJ,"LENGTH","response.log",LOG.LENGTH,"",RERR)þþ      TEST.MSG='Did not see 100 Continue!'þ      TEST.STATUS=0þ      FOR X=1 TO LOG.LENGTH UNTIL TEST.STATUS # 0þ         CALL WOBJ(OBJ,"GET","response.log[":X-1:"]",LOG.LINE,"",RERR)þ         IF INDEX(LOG.LINE,"100 Continue",1) THENþ            TEST.MSG=LOG.LINEþ            TEST.STATUS=1þ         ENDþ      NEXT Xþþ      GOSUB end.testþþ      STOPþ      *þ      GOSUB start.testþ      RETURNþ      *þprocess.error: *þ      IF RERR<1> THENþ         TEST.STATUS=-1þ         TEST.MSG=RERR<1>þ      ENDþ      RETURNþ      *þ      *þstart.test: *þ      TEST.STATUS=0þ      TEST.MSG="Success"þ      PRINT "":TEST[1,20]"L(#20)":þ      RETURNþ      *þend.test: *þ      PRINT "  ":TEST.MSG[1,50]"L(#45)":þ      PRINT " ":þ      PRE=''; AFT=''þ      BEGIN CASEþ         CASE TEST.STATUS=2; ERROR="Warning"; PRE=''; AFT=''þ         CASE TEST.STATUS; ERROR="Passed"þ         CASE 1; ERROR="Failed"; PRE=@(-13); AFT=@(-14)þ      END CASEþ      PRINT PRE:"[":þ      PRINT ERROR"L(#7)":þ      PRINT "]":AFTþ*      IF NOT(TEST.STATUS) THEN DEBUGþ      RETURNþþþþ      ******************************************************************************þ      * FILEIO TESTþ      ******************************************************************************þþfileiotest: *þþ      * NEWLINE.IN  = WRITE RULEþ      * NEWLINE.OUT = READ RULþ      * NEWLINE.DEL = ACTUAL DATA DELIMITERþ      * NEWDATA.IN  = DATA TO WRITEþ      * NEWDATA.RAW = DATA IN RAW FORMATþ      * NEWDATA.OUT = DATA TO COMPARE TOþþ      BEGIN CASEþ         CASE NEWLINE.IN='UNIX' OR NEWLINE.IN="LF"; NEWLINE.IN.DEL=CHAR(10)þ         CASE NEWLINE.IN='DOS' OR NEWLINE.IN="CRLF"; NEWLINE.IN.DEL=CHAR(13):CHAR(10)þ         CASE NEWLINE.IN='CR'; NEWLINE.IN.DEL=CHAR(13)þ         CASE NEWLINE.IN="MV"; NEWLINE.IN.DEL=CHAR(254)þ         CASE NEWLINE.IN="RAW"; NEWLINE.IN.DEL=NEWLINE.DELþ         CASE NEWLINE.IN="WINDOWS"; NEWLINE.IN.DEL=CHAR(13):CHAR(10)þ         CASE 1; NEWLINE.IN.DEL=CHAR(10)þ      END CASEþþ      BEGIN CASEþ         CASE NEWLINE.OUT='UNIX' OR NEWLINE.OUT="LF"; NEWLINE.OUT.DEL=CHAR(10)þ         CASE NEWLINE.OUT='DOS' OR NEWLINE.OUT="CRLF"; NEWLINE.OUT.DEL=CHAR(13):CHAR(10)þ         CASE NEWLINE.OUT='CR'; NEWLINE.OUT.DEL=CHAR(13)þ         CASE NEWLINE.OUT="MV"; NEWLINE.OUT.DEL=CHAR(254)þ         CASE NEWLINE.OUT="RAW"; NEWLINE.OUT.DEL=NEWLINE.IN.DELþ         CASE NEWLINE.OUT="WINDOWS"; NEWLINE.OUT.DEL=CHAR(13):CHAR(10)þ         CASE 1; NEWLINE.OUT.DEL=CHAR(10)þ      END CASEþþþ      *TMP.D=OCONV(TIME(),'MTS')þ      TMP.D='L1'þ      NEWDATA.IN = TMP.D:NEWLINE.DEL:'L2'þ      NEWDATA.RAW = TMP.D:NEWLINE.IN.DEL:'L2'þ      NEWDATA.OUT = TMP.D:NEWLINE.OUT.DEL:'L2'þþ      * 12/21/2020 PATRICKþ      *þ      * I had a hell of a time with this.  When to add or not to addþ      * a new line is the issue.  When dealing with Raw and MV I hadþ      * to add these weird case statements to handle both the read testþ      * and the raw testþþ      * This is for the read testþþ      BEGIN CASEþ         CASE NEWLINE.OUT='RAW' AND NEWLINE.IN='MV'þ         CASE NEWLINE.OUT='RAW' AND NEWLINE.IN='RAW'þ         CASE NEWLINE.OUT='RAW'; NEWDATA.OUT:=NEWLINE.IN.DELþ      END CASEþþ      * This is for the raw (traw) test.  This is where I read backþ      * in what was written in raw mode.  The above one happens as partþ      * of the loop test and is redundant since Raw already happens.þþ      BEGIN CASEþ         CASE NEWLINE.IN = 'RAW'þ         CASE NEWLINE.IN = 'MV'þ         CASE 1; NEWDATA.RAW:=NEWLINE.IN.DELþ      END CASEþþ      PRINT "Testing Write - Newline->":NEWLINE.IN:' Read->':NEWLINE.OUTþ      TMP.NEWLINE.IN=NEWDATA.INþ      TMP.NEWLINE.OUT=''þ      GOSUB fileio.test.msgþ      PRINT 'Testing data: ':FIELD(TEST.MSG,'-',1)þþ      TEST="WFILEIO-WRITE ":NEWLINE.INþþ      USER.NO=FIELD(OCONV('','U50BB'),' ',1)þ      GOSUB start.testþ      CALL @WOBJ.RTNE(FOBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(FOBJ,"SET","action","WRITE","",RERR)þ      TMP.NEWLINE.IN=NEWLINE.INþ      CALL @WOBJ.RTNE(FOBJ,"SET","newline",NEWLINE.IN,"",RERR)þþ      TMP.FILE.NAME=TMP.DIR:FILEDELIM:'TMP-':USER.NO:'.txt'þ      *TEST.MSG=TMP.FILE.NAMEþ      CALL @WOBJ.RTNE(FOBJ,"SET","path",TMP.FILE.NAME,"",RERR)þ      SAVE.FOBJ=FOBJþþþ      TMP.DATA = NEWDATA.INþ      TMP.NEWLINE.OUT = TMP.DATAþþ      CALL @WOBJ.RTNE(FOBJ,"SET","data",TMP.DATA,"",RERR)þþ      CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.statusmsg",RESPONSE.STATUS.MSG,"",RERR)þ      TEST.STATUS=RESPONSE.STATUSþþ      IF NOT(RESPONSE.STATUS) THEN TEST.MSG:=RESPONSE.STATUS.MSGþ      GOSUB end.testþþ      IF NOT(TEST.STATUS) THEN STOP "Test Failed, no reason to continue"þþ      TEST='WFILEIO-READ TRAW'þ      GOSUB start.testþþ      * NOW READ IT BACK INþ      CALL @WOBJ.RTNE(FOBJ,"SET","action","READ","",RERR)þ      CALL @WOBJ.RTNE(FOBJ,"SET","newline","RAW","",RERR)þ      CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.data",RESPONSE.DATA,"",RERR)þ      TMP.NEWLINE.IN = NEWDATA.RAWþ      TMP.NEWLINE.OUT = RESPONSE.DATAþ      GOSUB fileio.test.msgþþ      TEST.STATUS=1þ      IF NEWDATA.RAW # RESPONSE.DATA THEN TEST.STATUS=0þ      GOSUB end.testþþ      TEST='WFILEIO-READ ':NEWLINE.OUTþ      GOSUB start.testþþ      * NOW READ IT BACK INþ      CALL @WOBJ.RTNE(FOBJ,"SET","action","READ","",RERR)þ      CALL @WOBJ.RTNE(FOBJ,"SET","newline",NEWLINE.OUT,"",RERR)þ      CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.data",RESPONSE.DATA,"",RERR)þ      TMP.NEWLINE.IN = NEWDATA.OUTþ      TMP.NEWLINE.OUT = RESPONSE.DATAþþ      GOSUB fileio.test.msgþþ      TEST.STATUS=1þ      IF NEWDATA.OUT # RESPONSE.DATA THEN TEST.STATUS=0þ      GOSUB end.testþþ      TEST="WFILEIO-DELETE"; GOSUB start.testþ      FOBJ=SAVE.FOBJþ      CALL @WOBJ.RTNE(FOBJ,"SET","action","DELETE","",RERR)þ      CALL MVDBTOOLKIT.WFILEIO(FOBJ)þþ      FOBJ=SAVE.FOBJþ      CALL @WOBJ.RTNE(FOBJ,"SET","action","READ","",RERR)þ      CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ      RESPONSE.DATA=""þþ      CALL @WOBJ.RTNE(FOBJ,"GET","response.data",RESPONSE.DATA,"",RERR)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.statusmsg",RESPONSE.STATUSMSG,"",RERR)þ      TEST.STATUS=1þ      TEST.MSG=TMP.FILE.NAME:' ':RESPONSE.STATUSþ      IF RESPONSE.STATUS=0 AND RESPONSE.DATA="" THEN NULL ELSE TEST.STATUS=0þ      GOSUB end.testþþ      RETURNþþfileio.test.msg: *þþ      CALL MVDBTOOLKIT.SWAP(TMP.NEWLINE.IN,CHAR(254),'(254)')þ      CALL MVDBTOOLKIT.SWAP(TMP.NEWLINE.IN,CHAR(13),'(13)')þ      CALL MVDBTOOLKIT.SWAP(TMP.NEWLINE.IN,CHAR(10),'(10)')þþ      CALL MVDBTOOLKIT.SWAP(TMP.NEWLINE.OUT,CHAR(254),'(254)')þ      CALL MVDBTOOLKIT.SWAP(TMP.NEWLINE.OUT,CHAR(13),'(13)')þ      CALL MVDBTOOLKIT.SWAP(TMP.NEWLINE.OUT,CHAR(10),'(10)')þþ      TEST.MSG=TMP.NEWLINE.IN:'->':TMP.NEWLINE.OUTþþ      RETURN0027DDMVDBTOOLKIT.WFILEIOþ0c2      SUBROUTINE MVDBTOOLKIT.WFILEIO(INOBJ)þ      **********************************************************************þ      *þ      * Copyright (C) 2017 Zumasys, Inc., All Rights Reservedþ      *þ      * Written by: Patrick Payne, Zumasysþ      * Date: June 7th 2018þ      * Description: WFILEIO MULTI PLATFORM WORKING WITH O/S FILESþ      *þ      **********************************************************************þ      *þ      * INOBJþ      *þ      * { "ACTION":"READ,WRITE,DELETE",þ      *   "PATH":"PATH TO THE FILE",þ      *   "DATA":"DATA FOR A WRITE",þ      *   "dosletter":"OPTIONAL DOS LETTER TO ADD TO PATH",þ      *   "NEWLINE":"CR,LF,CRLF,DOS,UNIX",þ      *   "PERMISSIONS":"TBD"þ      *   "response": {þ      *       "data":"responsedata",þ      *       "status":1-ok, else no,þ      *       "statusmsg":"statusmsg"þ      *   }þ      * }þ      *þ      * need to know the existing platformþþ      *PLATFORM.DELIM="\"þ      *PLATFORM.TYPE="WINDOWS"þ      *PLATFORM.MV="D3"þþ      CALL MVDBTOOLKIT.WPLATFORM(POBJ)þþ      INCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþþ      CALL @WOBJ.RTNE(POBJ,"GET","mvtype",PLATFORM.MV,"",RERR)þ      CALL @WOBJ.RTNE(POBJ,"GET","filedelim",PLATFORM.DELIM,"",RERR)þ      CALL @WOBJ.RTNE(POBJ,"GET","platform",PLATFORM.TYPE,"",RERR)þþ      FSTATUS=1þ      FSTATUSMSG="OK"þþ      CALL @WOBJ.RTNE(INOBJ,"GET","action",FILEIO.ACTION,"",RERR)þ      CALL @WOBJ.RTNE(INOBJ,"GET","path",FILEIO.PATH,"",RERR)þ      CALL @WOBJ.RTNE(INOBJ,"GET","data",FILEIO.DATA,"",RERR)þ      CALL @WOBJ.RTNE(INOBJ,"GET","dosletter",FILEIO.DOSLETTER,"",RERR)þ      CALL @WOBJ.RTNE(INOBJ,"GET","newline",FILEIO.NEWLINE,"",RERR)þ      CALL @WOBJ.RTNE(INOBJ,"GET","permissions",FILEIO.PERMISSIONS,"",RERR)þþ      *CALL @WOBJ.RTNE(OUTOBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(INOBJ,"SET.OBJECT","response","{}","",RERR)þþ      FILEIO.ACTION=OCONV(FILEIO.ACTION,"MCU")þ      FILEIO.NEWLINE=OCONV(FILEIO.NEWLINE,"MCU")þþ      IF FILEIO.ACTION = "" THENþ         FSTATUS=0þ         FSTATUSMSG="No action defined"þ         GOTO end.of.runþ      ENDþþ      IF FILEIO.PATH = "" THENþ         FSTATUS=0þ         FSTATUSMSG="No path defined"þ         GOTO end.of.runþ      ENDþþ      BEGIN CASEþ         CASE FILEIO.NEWLINE='UNIX' OR FILEIO.NEWLINE="LF"; NL=CHAR(10)þ         CASE FILEIO.NEWLINE='DOS' OR FILEIO.NEWLINE="CRLF"; NL=CHAR(13):CHAR(10)þ         CASE FILEIO.NEWLINE='CR'; NL=CHAR(13)þ         CASE FILEIO.NEWLINE="MV"; NL=CHAR(254)þ         CASE FILEIO.NEWLINE="RAW"; NL=""þ         CASE FILEIO.ACTION="WRITE" AND PLATFORM.MV="JBASE" AND PLATFORM.TYPE="WINDOWS"; NL=CHAR(13):CHAR(10)þ         CASE FILEIO.ACTION="WRITE" AND PLATFORM.MV="JBASE"; NL=CHAR(10)þ         CASE FILEIO.ACTION="WRITE" AND PLATFORM.MV="D3"; NL=CHAR(13):CHAR(10)þ         CASE FILEIO.ACTION="READ" AND PLATFORM.MV="JBASE" AND PLATFORM.TYPE="WINDOWS"; NL=@AMþ         CASE FILEIO.ACTION="READ" AND PLATFORM.MV="JBASE"; NL=@AMþ         CASE FILEIO.ACTION="READ" AND PLATFORM.MV="D3"; NL=@AMþ         CASE PLATFORM.TYPE="WINDOWS"; NL=CHAR(13):CHAR(10)þ         CASE 1; NL=CHAR(10)þ      END CASEþþ      PARSED.FILEIO.PATH=""þ      L=LEN(FILEIO.PATH)þ      FOR X=1 TO Lþ         C=FILEIO.PATH[X,1]þ         IF C=PLATFORM.DELIM THENþ            PARSED.FILEIO.PATH:=@AMþ         END ELSEþ            PARSED.FILEIO.PATH:=Cþ         ENDþ      NEXT Xþþ      *PARSED.FILEIO.PATH=EXCHANGE(FILEIO.PATH,PLATFORM.DELIM,@AM)þ      PARSED.FILEIO.PATH=FILEIO.PATHþ      CONVERT PLATFORM.DELIM TO @AM IN PARSED.FILEIO.PATHþ      PARSED.FILEIO.PARTS=DCOUNT(PARSED.FILEIO.PATH,@AM)þþ      * JBASE DOES NOT APPEAR TO HONOR WINDOWS ENVIROMENT VARIABLES IN THE OPENþ      * THIS IS MAKING %USERPROFILE% NOT WORKþ      *þ      * WE ARE GOING TO LOOP THRU THE THE PARTS AN EXPAND THEM OURSELVESþ      *þ      * THIS HAS BEEN TESTED ON JBASE WINDOWS SO FAR.þ      *þ      FOR P=1 TO PARSED.FILEIO.PARTSþ         THIS.PART=PARSED.FILEIO.PATH<P>þ         IF THIS.PART[1,1]='%' OR THIS.PART[1,1]="$" THENþ            CONVERT '%$' TO '' IN THIS.PARTþ            * 9/4/2019 PAP Modified this to use mvdbtoolkit.wgetenvþþ            *       IF GETENV(THIS.PART,NEW.THIS.PART) THENþ            *           PARSED.FILEIO.PATH<P>=NEW.THIS.PARTþ            *       ENDþ            CALL MVDBTOOLKIT.WGETENV(THIS.PART,NEW.THIS.PART)þ            IF NEW.THIS.PART # "" THEN PARSED.FILEIO.PATH<P>=NEW.THIS.PARTþ         ENDþ      NEXT Pþþþ      PARSED.FILEIO.FILE.NAME=PARSED.FILEIO.PATH<PARSED.FILEIO.PARTS>þ      FILEIO.JUST.PATH=DELETE(PARSED.FILEIO.PATH,PARSED.FILEIO.PARTS)þ      *FILEIO.JUST.PATH=EXCHANGE(FILEIO.JUST.PATH,@AM,PLATFORM.DELIM)þþ      CONVERT @AM TO PLATFORM.DELIM IN FILEIO.JUST.PATHþþþ      CALL @WOBJ.RTNE(INOBJ,"SET.OBJECT","work","{}","",RERR)þ      CALL @WOBJ.RTNE(INOBJ,"SET","work.parsed_fileio_file_name",PARSED.FILEIO.FILE.NAME,"",RERR)þþ      CALL @WOBJ.RTNE(INOBJ,"SET","work.fileio_just_path",FILEIO.JUST.PATH,"",RERR)þ      CALL @WOBJ.RTNE(INOBJ,"SET","work.platform",PLATFORM.TYPE,"",RERR)þ      CALL @WOBJ.RTNE(INOBJ,"SET","work.mvtype",PLATFORM.MV,"",RERR)þ      CALL @WOBJ.RTNE(INOBJ,"SET","work.filedelim",PLATFORM.DELIM,"",RERR)þþ      CALL @WOBJ.RTNE(INOBJ,"SET.OBJECT","response","{}","",RERR)þ      * lets have a seperate routine for each platformþþ      BEGIN CASEþ         CASE FILEIO.ACTION="READ"þ            CALL @WOBJ.RTNE(INOBJ,"SET.STRING","response.data","","",RERR)þ         CASE FILEIO.ACTION="WRITE"þ            BEGIN CASEþ               CASE INDEX(FILEIO.DATA,CHAR(13):CHAR(10),1)þ                  SOURCE.NL=CHAR(13):CHAR(10)þ               CASE INDEX(FILEIO.DATA,CHAR(13),1)þ                  SOURCE.NL=CHAR(13)þ               CASE INDEX(FILEIO.DATA,@AM,1)þ                  SOURCE.NL=@AMþ               CASE 1þ                  SOURCE.NL=CHAR(10)þ            END CASEþ            *DEBUGþ            * IF NL = CHAR(13):CHAR(10) THEN DEBUGþ            DREC=FILEIO.DATA; DT='FILEIODATA'; GOSUB debug.recþ            DREC=NL; DT='nl'; GOSUB debug.recþ            DREC=SOURCE.NL; DT='source.nl'; GOSUB debug.recþ            IF NL # "" AND SOURCE.NL # NL THENþ               *CONVERT SOURCE.NL TO NL IN FILEIO.DATAþ               *CONVERT @AM TO NL IN FILEIO.DATAþ               CALL MVDBTOOLKIT.SWAP(FILEIO.DATA,SOURCE.NL,NL)þ               CALL MVDBTOOLKIT.SWAP(FILEIO.DATA,@AM,NL)þ            ENDþ            IF FILEIO.NEWLINE="RAW" OR FILEIO.NEWLINE="MV" THEN NULL ELSEþ                FILEIO.DATA:=NLþ            ENDþ            CALL @WOBJ.RTNE(INOBJ,"SET.STRING","data",FILEIO.DATA,"",RERR)þ         CASE FILEIO.ACTION="DELETE"þ         CASE 1þ            FSTATUS=0þ            FSTATUSMSG="Invalid action"þ            CALL @WOBJ.RTNE(INOBJ,"SET.NUMBER", "response.status", FSTATUS,"",RERR)þ            CALL @WOBJ.RTNE(INOBJ,"SET.STRING", "response.statusmsg", FSTATUSMSG, "", RERR)þ            GOTO end.of.runþ      END CASEþþ      BEGIN CASEþ         CASE PLATFORM.MV="D3"þ            FILEIO.RTNE="MVDBTOOLKIT.WFILEIO.D3"þ            CALL MVDBTOOLKIT.WFILEIO.D3(INOBJ)þ         CASE PLATFORM.MV="JBASE"þ            FILEIO.RTNE="MVDBTOOLKIT.W.FILEIO.JBASE"þ            CALL MVDBTOOLKIT.WFILEIO.JBASE(INOBJ)þ         CASE PLATFORM.MV="UNIVERSE"þ            FILEIO.RTNE="MVDBTOOLKIT.WFILEIO.UNIVERSE"þ            CALL MVDBTOOLKIT.WFILEIO.UNIVERSE(INOBJ)þ         CASE PLATFORM.MV="UNIDATA"þ            FILEIO.RTNE="MVDBTOOLKIT.WFILEIO.UNIDATA"þ            CALL MVDBTOOLKIT.WFILEIO.UNIDATA(INOBJ)þ         CASE PLATFORM.MV="QM"þ            * QM SUPPORTS OPENPATHþ            CALL MVDBTOOLKIT.WFILEIO.QM(INOBJ)þ         CASE 1þ            DEBUGþ            FSTATUS=0þ            FSTATUSMSG="Invalid Platform ":PLATFORM.MVþ            GOTO end.of.runþ      END CASEþþ      BEGIN CASEþ         CASE FILEIO.ACTION="READ"þ            CALL @WOBJ.RTNE(INOBJ,"GET","response.data",RESPONSE.DATA,"",RERR)þ            BEGIN CASEþ               CASE INDEX(RESPONSE.DATA,CHAR(13):CHAR(10),1)þ                  SOURCE.NL=CHAR(13):CHAR(10)þ               CASE INDEX(RESPONSE.DATA,CHAR(13),1)þ                  SOURCE.NL=CHAR(13)þ               CASE INDEX(RESPONSE.DATA,@AM,1)þ                  SOURCE.NL=@AMþ               CASE 1þ                  SOURCE.NL=CHAR(10)þ            END CASEþþ            *IF NL = "" THEN DEBUGþ            *DREC=NL; PRINT "NL"; GOSUB debug.recþ            *DREC=SOURCE.NL; PRINT "SOURCE.NL"; GOSUB debug.recþ            *DREC=RESPONSE.DATA; PRINT "RESPONSE.DATA: "; GOSUB debug.recþ            IF NL # "" AND NL # SOURCE.NL THENþ               *CONVERT SOURCE.NL TO NL IN RESPONSE.DATAþ               *CONVERT @AM TO NL IN RESPONSE.DATAþ               CALL MVDBTOOLKIT.SWAP(RESPONSE.DATA,SOURCE.NL,NL)þ               *DREC=RESPONSE.DATA; PRINT "AFTER SWAP1: "; GOSUB debug.recþ               CALL MVDBTOOLKIT.SWAP(RESPONSE.DATA,@AM,NL)þ               *DREC=RESPONSE.DATA; PRINT "AFTER SWAP2: ";GOSUB debug.recþ               BEGIN CASEþ                  CASE INDEX(RESPONSE.DATA,CHAR(13):CHAR(10),1)þ                     SOURCE.NL=CHAR(13):CHAR(10)þ                  CASE INDEX(RESPONSE.DATA,CHAR(13),1)þ                     SOURCE.NL=CHAR(13)þ                  CASE INDEX(RESPONSE.DATA,@AM,1)þ                     SOURCE.NL=@AMþ                  CASE 1þ                     SOURCE.NL=CHAR(10)þ               END CASEþþ            ENDþ            IF FILEIO.NEWLINE # "RAW" THENþ               REC.LEN=LEN(RESPONSE.DATA)þ               NL.LEN=LEN(SOURCE.NL)þ               END.OF.FILE=RESPONSE.DATA[REC.LEN-NL.LEN+1,NL.LEN]þ               DREC=END.OF.FILE; DT='END.OF.FILE: '; GOSUB debug.recþ               DREC=SOURCE.NL; DT='NL: '; GOSUB debug.recþ               IF END.OF.FILE = SOURCE.NL THENþ                  RESPONSE.DATA=RESPONSE.DATA[1,REC.LEN-NL.LEN]þ               ENDþ               DREC=RESPONSE.DATA; DT='AFT REC: '; GOSUB debug.recþ            ENDþ            CALL @WOBJ.RTNE(INOBJ,"SET.STRING","response.data",RESPONSE.DATA,"",RERR)þ         CASE FILEIO.ACTION="WRITE"þ         CASE FILEIO.ACTION="DELETE"þ      END CASEþend.of.run: *þþ      RETURNþþdebug.rec:þ      RETURNþ      PRINT; PRINT DTþ      DL=LEN(DREC)þ      FOR DX=1 TO DLþ         DC=DREC[DX,1]þ         PRINT DX,SEQ(DC)þ      NEXT DXþ      INPUT WAITþ      RETURNþ00301BMVDBTOOLKIT.APP.INSTALLERþ0c2*þ* Copyright (C) 2009 Sierra Bravo Corporation, All Rights Reservedþ*þ* Written by: Luke Bucklin, Sierra Bravo Corporationþ* Date: 07/15/2009þ* Description: Application installerþ*þ* Modified By: Dave Bucklin, Nerdery Interactive Labsþ* Date: 02/04/2011þ* Description: Add overwrite flag, clashes handling specific to MVDashboardþ*þ* Modified By: Mike Street, Zumasysþ* Date: 07/22/2015þ* Description: Adapt for UniDataþ*þ* Modified By: Peter Schellenbach, Zumasysþ* Date: 07/28/2015þ* Description: added DATA stacking for EXECUTE commands (UniData CONVERT.DICTS program)þ*þ*þ    BUFFER = ""þ*þ    INSTALL.LOG.ON = 0þ    INSTALL.LOG.ID = "INSTALL*":DATE():"*":TIME()þ    INSTALL.LOG = ""þ    PROCESS.STATUS = 0þ    OVR.FLAG = 0þ    PROMPT ""þ    PRINT "File path: ":    þ    INPUT PACKAGE.FILEþ    IF PACKAGE.FILE = "VERSION" THENþ        PRINTþ        PRINT "Installer Version"þ        PRINT "1.0"þ        STOPþ    ENDþ*þ    returnCode = ""þ*þ    OPENSEQ PACKAGE.FILE TO HANDLE ELSEþ        PRINT "Unable to open sequential file"þ        STOPþ    ENDþ*UD   HANDLE = %OPEN(PACKAGE.FILE,O$RDONLY+O$BINARY)þ*UD   IF NOT(HANDLE) THENþ*UD       PRINT "Unable to open file." ; STOPþ*UD   ENDþ*þ    L = 0þ    PACKET = ""þ    LOOP    þ*UD     L = %READ(HANDLE,BUFFER,10000)þ*UDþ        OSBREAD BUFFER FROM HANDLE LENGTH 10000 þ*UD   IF PACKET = '' THENþ*UD      CRT 'CANT READ BUFFER'þ*UD      STOPþ*UD    ENDþ*UD   BUFFER=''þ*UD ENDþ        L=LEN(BUFFER)þ*END UD*þ    WHILE L > 0 DOþ        PACKET := BUFFERþ    REPEATþ    IF PACKET = "" THENþ        PRINT "No package."þ        STOPþ    ENDþ    INSTALL.ID = TIMEDATE()þ    KEEP.SOURCE = "1"þ*þ    PRINTþ    PRINT "Installing..."þ*þ    OPEN '','MV.PACKED.FILE' TO F.PACKED.FILE ELSEþ        CMD = "CREATE-FILE MV.PACKED.FILE 1 31"þ        GOSUB EXEC.CMDþ        OPEN '','MV.PACKED.FILE' TO F.PACKED.FILE ELSEþ            ERRFILE = "MV.PACKED.FILE"þ            GOSUB OPEN.ERRþ            STOPþ        ENDþ    ENDþ    WRITE PACKET ON F.PACKED.FILE, "PACKAGE"þþ    OPEN '','VOC' TO F.MD ELSEþ        ERRFILE = "VOC"þ        GOSUB OPEN.ERRþ        STOPþ    ENDþ    OPEN "MV.INSTALL" TO F.INSTALL ELSEþ        CMD = "CREATE-FILE MV.INSTALL 1 11"þ        GOSUB EXEC.CMDþ        OPEN "MV.INSTALL" TO F.INSTALL ELSEþ            ERRFILE = "MV.INSTALL"þ            GOSUB OPEN.ERRþ            STOPþ        ENDþ    ENDþ    OPEN "MV.INSTALL.CF" TO F.INSTALL.CF ELSEþ        CMD = "CREATE-FILE MV.INSTALL.CF 1 11"þ        GOSUB EXEC.CMDþ        OPEN "MV.INSTALL.CF" TO F.INSTALL.CF ELSEþ            ERRFILE = "MV.INSTALL.CF"þ            GOSUB OPEN.ERRþ            STOPþ        ENDþ    ENDþ    OPEN "MVAPPS.INSTALLED" TO F.MVAPPS.INSTALLED ELSEþ        CMD = "CREATE-FILE MVAPPS.INSTALLED 3 31"þ        GOSUB EXEC.CMDþ        OPEN "MVAPPS.INSTALLED" TO F.MVAPPS.INSTALLED ELSEþ            ERRFILE = "MVAPPS.INSTALLED"þ            GOSUB OPEN.ERRþ            STOPþ        ENDþ    ENDþ    OPEN "DICT","MVDB.CLASHES" TO FD.MVDB.CLASHES ELSEþ        CMD = "CREATE-FILE DICT MVDB.CLASHES 3"þ        GOSUB EXEC.CMDþ    ENDþ    INSTALL.LOG.ON = 1þ*þ    CLEARFILE F.INSTALLþ    DELETE F.INSTALL.CF, "MVAPPS-PRE-SCRIPT"      ;* Get rid of this just in case one is left overþ    DELETE F.INSTALL.CF, "MVAPPS-POST-SCRIPT"þ    DELETE F.INSTALL.CF, "PACKAGE.INFO"þ    TARGET = F.INSTALLþ    TARGET.NAME = "MV.INSTALL"þ    GOSUB UNPACKþ* All individual file packages are now in INSTALLþ* Unpack the MD scriptsþ    READ PACKET FROM F.INSTALL, "MV.INSTALL.CF" THENþ        TARGET = F.INSTALL.CFþ        TARGET.NAME = "MV.INSTALL.CF"þ        GOSUB UNPACKþ        DELETE F.INSTALL, "MV.INSTALL.CF"þ    ENDþ*þ* Execute scripts that are required prior to compilationþ*þ    READ CMD FROM F.INSTALL.CF, "MVAPPS-PRE-SCRIPT" THENþ        LOG.LINE = TIMEDATE():": Processing PRE-INSTALL commands..."þ        INSTALL.LOG<-1> = LOG.LINEþ* Execute commands that need to be run before the install process beginsþ        GOSUB EXEC.CMDþ        LOG.LINE = TIMEDATE():": Completed PRE-INSTALL commands."þ        INSTALL.LOG<-1> = LOG.LINEþ    ENDþ    READ PACKAGE.INFO FROM F.INSTALL.CF, "PACKAGE.INFO" ELSE PACKAGE.INFO = ""þ    PACKAGE.ID = PACKAGE.INFO<6>þ    PACKAGE.INFO<4> = DATE()þ    PACKAGE.INFO<5> = TIME()þ*þ    SELECT F.INSTALLþ    LOOPþ        READNEXT PKG.ID ELSE EXITþ        IF PKG.ID # "" THENþ            READ PACKET FROM F.INSTALL, PKG.ID THENþ                TARGET.FILE = FIELD(PKG.ID," ",1)þ                IF TARGET.FILE[1,7] = "BINARY:" THEN TARGET.FILE=TARGET.FILE[8,999]        ;*UDþ                DICT.MOD = FIELD( PKG.ID," ",2)þ                DATA.MOD = FIELD( PKG.ID," ",3)þ                DICT = ""þ                IF FIELD( PKG.ID,'_',1 ) = "DICT" THENþ                    TARGET.FILE = FIELD( PKG.ID, '_', 2 )þ                    IF TARGET.FILE[1,7] = "BINARY:" THEN TARGET.FILE=TARGET.FILE[8,999]    ;*UDþ                    DICT = "DICT"þ                ENDþ                OPEN DICT,TARGET.FILE TO F.TARGET ELSEþ                    IF NOT(INDEX(TARGET.FILE,':',1)) THENþ                        IF DICT.MOD = "" THEN DICT.MOD = 3þ                        IF DATA.MOD = "" THEN DATA.MOD = 31þ                        CMD = "CREATE-FILE ":TARGET.FILE:" ":DICT.MOD:" ":DATA.MODþ                        GOSUB EXEC.CMDþ                    ENDþ                    OPEN DICT,TARGET.FILE TO F.TARGET ELSEþ                        PRINT "Unable to create file ":TARGET.FILEþ                        GOSUB CLEANUPþ                        STOPþ                    ENDþ                ENDþ                TARGET = F.TARGETþ                TARGET.NAME = TRIM(DICT:" ":TARGET.FILE)þ                GOSUB UNPACKþ            ENDþ        ENDþ    REPEATþ*þ* Execute script required post compilationþ*þ    READ CMD FROM F.INSTALL.CF, "MVAPPS-POST-SCRIPT" THENþ        LOG.LINE = TIMEDATE():": Processing POST-INSTALL commands..."þ        INSTALL.LOG<-1> = LOG.LINEþ* Use compile options if they are present.þ        OPEN 'MVDB.CONTROL' TO F.MVDB.CONTROL THENþ            READ COMPILE.SETUP FROM F.MVDB.CONTROL, 'COMPILE.SETUP' THENþ                COMPILE.VERB = FIELD(COMPILE.SETUP<1>,' ',1)þ                IF COMPILE.VERB # '' THENþ                    OPTS = FIELD(COMPILE.SETUP<1>,'(',2)þ                    IF OPTS # '' THEN OPTS = "(":OPTSþ                    CMD.CNT = DCOUNT( CMD, @AM )þ                    FOR CMD.XX = 1 TO CMD.CNTþ                        IF FIELD(CMD<CMD.XX>,' ',1) = 'BASIC' OR FIELD(CMD<CMD.XX>,' ',1) = 'COMPILE' THENþ*make sure we use the right verb and options from the compile.setupþ                            CMD<CMD.XX> = COMPILE.VERB:' ':CMD<CMD.XX>[INDEX(CMD<CMD.XX>,' ',1)+1,999]:' ':OPTSþ                        ENDþ                    NEXT CMD.XXþ                ENDþ            ENDþ        ENDþ* Execute commands that need to be run at the end of the install processþ        GOSUB EXEC.CMDþ        LOG.LINE = TIMEDATE():": Completed POST-INSTALL commands."þ        INSTALL.LOG<-1> = LOG.LINEþ    ENDþ*þ*UD*    IF NOT(KEEP.SOURCE) THENþ*UD*        FOR X = 1 TO DCOUNT( SOURCE.FILES, @AM )þ*UD*            CMD = "CLEAR-FILE DATA ":SOURCE.FILES<X>þ*UD*            GOSUB EXEC.CMDþ*UD*        NEXT Xþ*UD*    ENDþ    READ INSTALL.LIST FROM F.INSTALL.CF, "LAST.INSTALL" ELSE INSTALL.LIST = ""þ    INSTALL.LIST = INSERT( INSTALL.LIST, 1, 0, 0, INSTALL.ID )þ    WRITE INSTALL.LIST ON F.INSTALL.CF, "LAST.INSTALL"þ    GOSUB CLEANUPþ    INSTALL.LOG<-1> = TIMEDATE():": Install complete."þ    WRITE INSTALL.LOG ON F.INSTALL.CF, INSTALL.LOG.IDþ    WRITE PACKAGE.INFO ON F.MVAPPS.INSTALLED, PACKAGE.IDþ    PROCESS.STATUS = 1þ    GOSUB SEND.DATAþ    STOPþ*********þUNPACK:   *þ*********þ    PRINT "Unpacking ":TARGET.NAME:"... ":þ*þ    BYTES = 0þ    CNT = 0þ    LOOPþ        PLENGTH = OCONV( PACKET[1,6], 'MCXD' )þ        REC = PACKET[7,PLENGTH]þ        PACKET = PACKET[PLENGTH+7,9999999]þ        ID = REC<1>þ        REC = DELETE( REC, 1, 0, 0 )þ        TYP = REC[1,2]þ        OVR.FLAG = REC[3,1]þ        REC = REC[4,9999999]þ        IF TYP = "0x" THENþ            REC = OCONV( REC, 'MY' )þ            END ELSE IF TYP # "0c" THENþ                REC = TYP:RECþ            ENDþ*þ            CNT += 1þ            BYTES += LEN(REC)þ            IF OVR.FLAG THENþ                IF DICT = "" THENþ*If we're not installing DICT items, compare for CLASHESþ                    READ CLASH FROM TARGET, ID THENþ                        BEGIN CASEþ*Preserve dashboard user passwordsþ                        CASE TARGET.FILE = "MVDB.USERS"þ                            IF CLASH<1> # REC<1> THEN REC<1> = CLASH<1>þ*Preserve dashboard access profileþ                        CASE TARGET.FILE = "MVDB.DEFS"þ                            IF CLASH<5> # REC<5> THEN REC<5> = CLASH<5>þ*Preserve widget access profileþ                        CASE TARGET.FILE = "MVDB.WIDGETS"þ                            IF CLASH<2> # REC<2> THEN REC<2> = CLASH<2>þ*Preserve widget compile optionþ                        CASE TARGET.FILE = "MVDB.CONTROL" AND ID = "COMPILE.SETUP"þ                            IF CLASH<1> # REC<1> THEN REC<1> = CLASH<1>þ                        END CASEþ                        IF CLASH # '' AND REC # CLASH THENþ                            CLASH.NAME = TARGET.NAMEþ                            CONVERT " " TO "_" IN CLASH.NAMEþ                            OPEN 'MVDB.CLASHES,':CLASH.NAME TO F.CLASHES ELSEþ                                *UD* CMD = "CREATE-FILE DATA MVDB.CLASHES,":CLASH.NAME:" 7"þ                                CMD = "CREATE-FILE MULTIFILE MVDB.CLASHES,":CLASH.NAME:" 7" ; *UD*þ                                GOSUB EXEC.CMDþ                                OPEN 'MVDB.CLASHES,':CLASH.NAME TO F.CLASHES ELSEþ                                    PRINT "Unable to create file MVDB.CLASHES,":CLASH.NAMEþ                                    GOSUB CLEANUPþ                                    STOPþ                                ENDþ                            ENDþ                            WRITE CLASH ON F.CLASHES, IDþ                            CLOSE F.CLASHESþ                        ENDþ                    ENDþ                ENDþ                WRITE REC ON TARGET, IDþ            END ELSEþ                READ TST FROM TARGET, ID ELSEþ                    WRITE REC ON TARGET, IDþ                ENDþ            ENDþ            IF NOT(MOD(CNT,500)) THEN PRINT "*":þ        UNTIL PACKET = "" DO REPEATþ        IF CNT # 1 THEN PLURAL = "s" ELSE PLURAL = ""þ        PRINT CNT:" record":PLURAL:"."þ        LOG.LINE = TIMEDATE():": UNPACKED ":CNT:" RECORDS TO ":TARGET.NAMEþ        INSTALL.LOG<-1> = LOG.LINEþ        RETURNþ**********þCLEANUP:  *þ**********þ        CLEARFILE F.INSTALLþ        CLEARFILE F.PACKED.FILEþ        RETURNþ*þEXEC.CMD: *þ*þ        CMD.CNT = DCOUNT( CMD, @AM )þ        FOR CMD.XX = 1 TO CMD.CNTþ            THIS.CMD = CMD<CMD.XX>þ            *UD* Stacked data?þ            IF INDEX(THIS.CMD,@VM,1) THENþ                THIS.DATA = THIS.CMD<1,1>þ                THIS.CMD = THIS.CMD<1,2>þ            END ELSEþ                THIS.DATA = ''þ            ENDþ            LOG.LINE = TIMEDATE():": EXEC: ":THIS.CMDþ            INSTALL.LOG<-1> = LOG.LINEþ            IF FIELD(THIS.DATA,' ',1) NE "SELECT" THENþ            DATA.CNT = DCOUNT(THIS.DATA,@VM)þ            *UD* Use DATA statements for stacked dataþ            FOR DATA.XX = 1 TO DATA.CNTþ                DATA THIS.DATA<1,DATA.XX>þ            NEXT DATA.XXþ            ENDþ            * Run the commandþ            IF FIELD(THIS.DATA,' ',1) = "SELECT" THENþ                IF FIELD(THIS.CMD,' ',1) = "CATALOG" THEN DATA "Y"þ                CRT "Executing   ":THIS.CMDþ                EXECUTE THIS.DATA : @AM : THIS.CMD þ            END ELSEþ                CRT "Executing   ":THIS.CMDþ                EXECUTE THIS.CMDþ            ENDþ            IF INSTALL.LOG.ON THENþ                WRITE INSTALL.LOG ON F.INSTALL.CF, INSTALL.LOG.IDþ            ENDþ        NEXT CMD.XXþ        RETURNþ*þOPEN.ERR: *þ*þ        LOG.LINE = TIMEDATE():": FILE OPEN ERROR: ":ERRFILEþ        INSTALL.LOG<-1> = LOG.LINEþ        PRINT LOG.LINEþ        GOSUB SEND.DATAþ        RETURNþ*þSEND.DATA:*þ*þ        PRINTþ        IF PROCESS.STATUS = 1 THEN INSTALL.STATUS = "Success" ELSE INSTALL.STATUS = "Failed"þ        PRINT "Install process finished. Status: ":INSTALL.STATUSþ        RETURNþ    END0003B4MVDBTOOLKIT.WCALL.DEBUGþ0c2SUBROUTINE MVDBTOOLKIT.WCALL.DEBUG(OBJ)þþCRT "Do you wish to debug wcall? ":; INPUT CONTþIF OCONV(CONT,"MCU")[1,1]="Y" THEN NULL ELSE RETURNþþ* This will do typical debugging workþCALL WOBJ(OBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þCALL WOBJ(OBJ,"GET","response.statusmsg",RESPONSE.STATUS.MSG,"",RERR)þþCRT "Status = ":RESPONSE.STATUS:' ':RESPONSE.STATUS.MSGþ* Show the actual Curl commandþþCALL WOBJ(OBJ,"GET","response.curl_cmnd",CURL.CMND,"",RERR)þþPRINT "Press return to see curl cmnd ":; INPUT CONTþþPRINT CURL.CMNDþþPRINT "Press return to see response ":; INPUT CONTþCALL WOBJ(OBJ,"GET","response.data",RESPONSE.DATA,"",RERR)þþPRINT "Response: "þPRINT RESPONSE.DATAþþPRINT "Press return to see response.log":; INPUT CONTþþCALL WOBJ(OBJ,"LENGTH","response.log",LOG.LENGTH,"",RERR)þþFOR X=1 TO LOG.LENGTHþ    CALL WOBJ(OBJ,"GET","response.log[":X-1:"]",LOG.LINE,"",RERR)þ    PRINT LOG.LINEþNEXT XþþRETURNþþ00005EMVDBTOOLKIT.SWAP.DEFAULTþ0c2SUBROUTINE MVDBTOOLKIT.SWAP.DEFAULT(V,F,T)þþV=SWAP(V,F,T)þþRETURNþ00033CMVDBTOOLKIT.WGETENVþ0c2SUBROUTINE MVDBTOOLKIT.WGETENV(VAR.NAME,RETURN.VALUE)þþINCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþþCALL MVDBTOOLKIT.WPLATFORM(POBJ)þþCALL @WOBJ.RTNE(POBJ,"GET","mvtype",PLATFORM.MV,"",RERR)þCALL @WOBJ.RTNE(POBJ,"GET","filedelim",PLATFORM.DELIM,"",RERR)þCALL @WOBJ.RTNE(POBJ,"GET","platform",PLATFORM.TYPE,"",RERR)þþ* THIS FUNCTION IS A CROSS PLATFORM WGET VAR FUNCTIONþþþBEGIN CASEþ    CASE PLATFORM.MV="D3" AND PLATFORM.TYPE="LINUX"þ        FILEIO.RTNE="MVDBTOOLKIT.WGETENV.D3"þ        CALL MVDBTOOLKIT.WGETENV.D3(VAR.NAME,RETURN.VALUE)þ    CASE PLATFORM.MV="JBASE"þ        FILEIO.RTNE="MVDBTOOLKIT.WGETENV.JBASE"þ        CALL MVDBTOOLKIT.WGETENV.JBASE(VAR.NAME,RETURN.VALUE)þ    CASE 1þ        CALL MVDBTOOLKIT.WGETENV.GENERIC(VAR.NAME,RETURN.VALUE,PLATFORM.MV,PLATFORM.TYPE)þEND CASEþþend.of.run: *þþRETURNþþ0003D7MVDBTOOLKIT.VALIDATE.CONFIG.INCLUDEþ0c2      * MVDBTOOLKIT.VALIDATE.CONFIG.INCLUDEþþ      * Special include that will validate our MVDB.CONTROL file existsþ      *þþ      OPEN "MVDB.CONTROL" TO F.INCLUDE.CONFIG ELSEþ         PRINT "Could not open MVDB.CONTROL!"þ         STOPþ      ENDþþ      READ VALIDATE.CONFIG.INCLUDE FROM F.INCLUDE.CONFIG, "MV.PLATFORM.JSON" ELSEþþ         * LETS TRY READING IT FROM THE DICT OF MVDBTOOLKIT.BPþ         F.INCLUDE.USE.DICT=1þþ         OPEN "DICT","MVDBTOOLKIT.BP" TO F.INCLUDE.DICT.MVDBTOOLKIT.BP ELSE F.INCLUDE.USE.DICT=0þþ         IF F.INCLUDE.USE.DICT THENþ            READ VALIDATE.CONFIG.INCLUDE FROM F.INCLUDE.DICT.MVDBTOOLKIT.BP, "MV.PLATFFORM.JSON" ELSE VALIDATE.CONFIG.INCLUDE=''þ            IF VALIDATE.CONFIG.INCLUDE # "" THENþ               WRITE VALIDATE.CONFIG.INCLUDE ON F.INCLUDE.CONFIG, "MV.PLATFROM.JSON"þ            ENDþ            CLOSE F.INCLUDE.DICT.MVDBTOOLKIT.BPþ         ENDþ      ENDþ      þ      CLOSE F.INCLUDE.CONFIG000156MVDBTOOLKIT.WEXECUTE.INCLUDEþ0c2* COMMON FOR EXECUTE *þCOMMON /MVDBWEX/ EXECUTE.COMMANDþCOMMON /MVDBWEX/ EXECUTE.DIRECTORYþCOMMON /MVDBWEX/ EXECUTE.DOCAPTUREþCOMMON /MVDBWEX/ EXECUTE.RETURNINGþCOMMON /MVDBWEX/ EXECUTE.RTNDATAþCOMMON /MVDBWEX/ EXECUTE.PASSLISTþCOMMON /MVDBWEX/ MV.TYPEþCOMMON /MVDBWEX/ PLATFORMþCOMMON /MVDBWEX/ EXECUTE.DEBUGþ0004E5MVDBTOOLKIT.WGETENV.GENERICþ0c2SUBROUTINE MVDBTOOLKIT.WGETENV.GENERIC(VAR.NAME, RETURN.VALUE, MVTYPE, PLATFORM)þþRETURN.VALUE=""þþ* WE ARE GOING TO JUST SHELL OUT AND GET THE ENVIRONMENT VARIABLE BASEDþ* ON THE PLATFORMþþBEGIN CASEþ    CASE MVTYPE="UNIVERSE" AND PLATFORM="LINUX"þ        CMND='sh -c "echo $':VAR.NAME:'"'þ    CASE MVTYPE="UNIVERSE" AND PLATFORM="WINDOWS"þ        CMND='dos /c "echo %':VAR.NAME:'%"'þ    CASE (MVTYPE="JBASE" OR MVTYPE="D3") AND PLATFORM="LINUX"þ        CMND='!echo $':VAR.NAMEþ    CASE MVTYPE="JBASE" AND PLATFORM="WINDOWS"þ         CMND='echo %':VAR.NAME:'%'þ    CASE MVTYPE="D3" AND PLATFORM="WINDOWS"þ        CMND='!echo %':VAR.NAME:'%'þ    CASE MVTYPE='UNIDATA' AND PLATFORM="WINDOWS"þ        CMND='!echo %':VAR.NAME:'%'þ    CASE MVTYPE='UNIDATA' AND PLATFORM="LINUX"þ        CMND='!echo $':VAR.NAMEþ    CASE MVTYPE='QM' AND PLATFORM="WINDOWS"þ        * QM DOES HAVE SYSTEM(1025) TO GET ENVIRONMENT STUFFþ        * STICKING WITH THIS FOR NOWþ        CMND='!echo %':VAR.NAME:'%'þ    CASE MVTYPE='QM' AND PLATFORM="LINUX"þ        CMND='!echo $':VAR.NAMEþ    CASE 1þ        CMND=''þEND CASEþþEXECUTE CMND CAPTURING RETURN.VALUEþþIF MVTYPE='UNIDATA' THENþ    RETURN.VALUE=RETURN.VALUE[1,LEN(RETURN.VALUE)-1]þENDþþRETURNþ000322MVDBTOOLKIT.EXPAND.PATHþ0c2SUBROUTINE MVDBTOOLKIT.EXPAND.PATH(PASSED.PATH)þþINCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþþCALL MVDBTOOLKIT.WPLATFORM(POBJ)þþCALL @WOBJ.RTNE(POBJ,"GET","mvtype",PLATFORM.MV,"",RERR)þCALL @WOBJ.RTNE(POBJ,"GET","filedelim",PLATFORM.DELIM,"",RERR)þCALL @WOBJ.RTNE(POBJ,"GET","platform",PLATFORM.TYPE,"",RERR)þþPARSED.PATH=PASSED.PATHþCONVERT PLATFORM.DELIM TO @AM IN PARSED.PATHþPARSED.PARTS=DCOUNT(PARSED.PATH,@AM)þþFOR P=1 TO PARSED.PARTSþ    THIS.PART=PARSED.PATH<P>þ    IF THIS.PART[1,1]='%' OR THIS.PART[1,1]="$" THENþ        CONVERT '%$' TO '' IN THIS.PARTþ         CALL MVDBTOOLKIT.WGETENV(THIS.PART,NEW.THIS.PART)þ         IF NEW.THIS.PART # "" THEN PARSED.PATH<P>=NEW.THIS.PARTþ    ENDþNEXT PþþCONVERT @AM TO PLATFORM.DELIM IN PARSED.PATHþþPASSED.PATH=PARSED.PATHþþRETURNþþ00002CMVDBTOOLKIT.TEST.INCLUDEþ0c2CMND = @SENTENCE0001E1MVDBTOOLKIT.SWAPþ0c2SUBROUTINE MVDBTOOLKIT.SWAP(V,F,T)þþ* MVDBTOOLKIT.SWAPþINCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþþ* PLATFORM INDEPENDENT SWAP COMMANDþCALL MVDBTOOLKIT.WPLATFORM(PLATFORMOBJ)þþCALL @WOBJ.RTNE(PLATFORMOBJ,"GET","mvtype",MV.TYPE,"",RERR)þþBEGIN CASEþ    CASE MV.TYPE='UNIVERSE'þ        CALL MVDBTOOLKIT.SWAP.UNIVERSE(V,F,T)þ    CASE MV.TYPE='UNIDATA'þ        CALL MVDBTOOLKIT.SWAP.UNIDATA(V,F,T)þ    CASE 1þ        CALL MVDBTOOLKIT.SWAP.DEFAULT(V,F,T)þEND CASEþþRETURNþ000CA6MVDBTOOLKIT.PACKAGE.INSTALLERþ0c2      * Install packagesþþ      * first, get a list of packagesþþ      CALL WOBJ(COBJ,"FROMJSON","","{}","",RERR)þþ      CALL MVDBTOOLKIT.WPLATFORM(PLATFORM.OBJ)þþ      CALL WOBJ(PLATFORM.OBJ,"GET","packagesurl",PACKAGES.URL,"",RERR)þþ      IF PACKAGES.URL = "" THENþ         PACKAGES.URL="https://raw.githubusercontent.com/zumasys/MVConnect/master/packages.json"þ      ENDþþ      CALL WOBJ(PLATFORM.OBJ,"GET","mvtype",MVTYPE,"",RERR)þ      þ      MVTYPE=OCONV(MVTYPE,"MCU")þ      þ      BEGIN CASEþ         CASE MVTYPE="D3"; MVTYPE2="d3"þ         CASE MVTYPE="JBASE"; MVTYPE2="jb"þ         CASE MVTYPE="QM"; MVTYPE2="qm"þ         CASE MVTYPE="UNIVERSE"; MVTYPE2="uv"þ         CASE MVTYPE="UNIDATA"; MVTYPE2="ud"þ         CASE 1þ             PRINT "Platform ":MVTYPE:" not supported"þ             STOPþ      END CASEþ      þ      CALL WOBJ(PLATFORM.OBJ,"GET","tmpdir",TMP.DIR,"",RERR)þ      þ      CALL WOBJ(PLATFORM.OBJ,"GET","filedelim",FILEDELIM,"",RERR)þ      þ      PRINT "Packages url: ":PACKAGES.URLþþ      CALL WOBJ(COBJ,"SET","url",PACKAGES.URL,"",RERR)þ      CALL WOBJ(COBJ,"SET","method","GET","",RERR)þþ      CRT "Getting package list...":þþ      CALL MVDBTOOLKIT.WCALL(COBJ)þþ      *CALL MVDBTOOLKIT.WCALL.DEBUG(COBJ)þþþ      CALL WOBJ(COBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þþ      CALL WOBJ(COBJ,"GET","response.statusmsg",RESPONSE.STATUS.MSG,"",RERR)þ      CALL WOBJ(COBJ,"GET","response.data",RESPONSE.DATA,"",RERR)þþ      PRINT RESPONSE.STATUS:' ':RESPONSE.STATUS.MSGþþ      CALL WOBJ(POBJ,"FROMJSON","",RESPONSE.DATA,"",RERR)þþ      IF RERR>0 THENþ         PRINT RERR<1>:" Error: ":RERR<2>þ         STOPþ      ENDþþ      CALL WOBJ(POBJ,"LENGTH","packages",NUMBER.PACKAGES,"",RERR)þþ      PRINT "Number packages: ":NUMBER.PACKAGESþþtop.of.packages: *þþ      PACKAGES=""þ      STOP.PACKAGE.LIST=0þ      PACKAGE=""þ      þ      FOR P=1 TO NUMBER.PACKAGES UNTIL STOP.PACKAGE.LISTþþ         CALL WOBJ(POBJ,"GET","packages[":P-1:"].name",PACKAGE.NAME,"",RERR)þ         CALL WOBJ(POBJ,"GET","packages[":P-1:"].version",PACKAGE.VERSION,"",RERR)þ         CALL WOBJ(POBJ,"GET","packages[":P-1:"].description",PACKAGE.DESCRIPTION,"",RERR)þþþ         PRINT P"MR(#4)":þ         PRINT " ":þ         PRINT PACKAGE.NAME:þ         PACKAGES<P>=PACKAGE.NAMEþ         þ         PRINT " ":þ         PRINT PACKAGE.VERSIONþ         PRINT "     ":PACKAGE.DESCRIPTIONþ         þ         IF NOT(MOD(P,10)) OR P=NUMBER.PACKAGES THENþ             PRINT "Package # to install, return for more, q to quit ":; INPUT PACKAGEþ             IF OCONV(PACKAGE,'MCU')='Q' THEN STOPþ             IF NUM(PACKAGE) THEN STOP.PACKAGE.LIST=1þ         ENDþ      NEXT Pþ      þ      IF PACKAGE="" THEN STOPþ      IF NOT(NUM(PACKAGE)) THENþ           LOCATE PACKAGE IN PACKAGES SETTING PACKAGE ELSE STOPþ      ENDþ      þ      IF PACKAGE < 1 OR PACKAGE > NUMBER.PACKAGES THEN STOPþþ      CALL WOBJ(POBJ,"GET","packages[":PACKAGE-1:"].name",PACKAGE.NAME,"",RERR)þ      CALL WOBJ(POBJ,"GET","packages[":PACKAGE-1:"].version",PACKAGE.VERSION,"",RERR)þþ           þ      COBJ=""þ      CALL WOBJ(COBJ,"FROMSTRING","","{}","",RERR)þ      þ      CALL MVDBTOOLKIT.PACKAGE.INSTALLER.SUB(PACKAGE.NAME,RESULT)þ      þ      þSTOPþþ000DC9MVDBTOOLKIT.WFILEIO.UNIDATAþ0c2SUBROUTINE MVDBTOOLKIT.WFILEIO.UNIDATA(FOBJ)þ**********************************************************************þ*þ* Copyright (C) 2017 Zumasys, Inc., All Rights Reservedþ*þ* Written by: Patrick Payne, Zumasysþ* Date: June 7th 2018þ* Description: WFILEIO MULTI PLATFORM WORKING WITH O/S FILESþ*þ**********************************************************************þ*þ* INOBJþ*þ* { "ACTION":"READ,WRTE,DELETE",þ*   "PATH":"PATH TO THE FILE",þ*   "DATA":"DATA FOR A WRITE",þ*   "dosletter":"OPTIONAL DOS LETTER TO ADD TO PATH",þ*   "NEWLINE":"CR,LF,CRLF,DOS,UNIX",þ*   "PERMISSIONS":"TBD",þ*   "debug":"Y or N",þ*   "response": {þ*       "data":"responsedata",þ*       "status":1-ok, else no,þ*       "statusmsg":"statusmsg" þ*   }þ* }þ*þ* need to know the existing platformþþ*PLATFORM.DELIM="\"þ*PLATFORM.TYPE="WINDOWS"þ*PLATFORM.MV="D3"þþINCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþþCALL @WOBJ.RTNE(FOBJ,"GET","debug",DO.DEBUG,"",RERR)þIF OCONV(DO.DEBUG[1,1],"MCU") = "Y" OR DO.DEBUG="1" THEN DO.DEBUG=1 ELSE DO.DEBUG=""þþCALL @WOBJ.RTNE(FOBJ,"GET","work.mvtype",PLATFORM.MV,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","work.filedelim",PLATFORM.DELIM,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","work.platform",PLATFORM.TYPE,"",RERR)þþFSTATUS=1þFSTATUSMSG="OK"þþCALL @WOBJ.RTNE(FOBJ,"GET","action",FILEIO.ACTION,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","path",FILEIO.PATH,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","data",FILEIO.DATA,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","dosletter",FILEIO.DOSLETTER,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","newline",FILEIO.NEWLINE,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","permissions",FILEIO.PERMISSIONS,"",RERR)þþ*CALL @WOBJ.RTNE(OUTOBJ,"FROMSTRING","","{}","",RERR)þþFILEIO.ACTION=OCONV(FILEIO.ACTION,"MCU")þFILEIO.NEWLINE=OCONV(FILEIO.NEWLINE,"MCU")þþCALL @WOBJ.RTNE(FOBJ,"GET","work.parsed_fileio_file_name",PARSED.FILEIO.FILE.NAME,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","work.fileio_just_path",FILEIO.JUST.PATH,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","work.platform",PLATFORM.TYPE,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","work.mvtype",PLATFORM.MVTYPE,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"GET","work.filedelim",PLATFORM.FILEDELIM,"",RERR)þþ* Lets create a q-pointerþþUSER.NO=FIELD(OCONV('','U50BB'),' ',1)þOPEN "VOC" TO FILE.VOC ELSEþ    STOP "COULD NOT OPEN VOC"þENDþþMD.ID='MVDBTOOLKIT-QPOINTER-':USER.NOþþMD.ENTRY='DIR'þMD.ENTRY<2>=FILEIO.JUST.PATHþWRITE MD.ENTRY ON FILE.VOC, MD.IDþþOPEN MD.ID TO FI ELSEþ   DELETE FILE.VOC, MD.IDþ    FSTATUS=0þ    FSTATUSMSG="Could not open file ":FILEIO.JUST.PATHþ    GOTO end.of.runþENDþþBEGIN CASEþ    CASE FILEIO.ACTION="READ"þ        GOSUB fileio.readþ    CASE FILEIO.ACTION="WRITE"þ        GOSUB fileio.writeþ    CASE FILEIO.ACTION="DELETE"þ        GOSUB fileio.deleteþ    CASE 1þ        FSTATUS=0þ        FSTATUSMSG="Invalid action"þ        GOTO end.of.runþEND CASEþþCLOSE FIþDELETE FILE.VOC, MD.IDþþend.of.run: *þCALL @WOBJ.RTNE(FOBJ,"SET.NUMBER", "response.status", FSTATUS,"",RERR)þCALL @WOBJ.RTNE(FOBJ,"SET.STRING", "response.statusmsg", FSTATUSMSG, "", RERR)þþþRETURNþþfileio.read: *þþREC=""þþREAD REC FROM FI, PARSED.FILEIO.FILE.NAME ELSEþ    FSTATUS=0þ    FSTATUSMSG="Could not find ":PARSED.FILEIO.FILE.NAMEþENDþþCALL @WOBJ.RTNE(FOBJ,"SET.STRING","response.data",REC,"",RERR)þþIF 0 THENþ    PRINT "PATH   :":FILEIO.JUST.PATHþ    PRINT "ID     :":PARSED.FILEIO.FILE.NAMEþ    PRINT "REC    :":RECþENDþþRETURNþþfileio.write: *þþWRITE FILEIO.DATA ON FI, PARSED.FILEIO.FILE.NAMEþFSTATUS=1þþRETURNþþfileio.delete: *þþDELETE FI, PARSED.FILEIO.FILE.NAMEþFSTATUS=1þþRETURN0007DBMVDBTOOLKIT.WPLATFORMþ0c2      SUBROUTINE MVDBTOOLKIT.WPLATFORM(PLATFORMOBJ)þ      **********************************************************************þ      *þ      * Copyright (C) 2017 Zumasys, Inc., All Rights Reservedþ      *þ      * Written by: Patrick Payne, Zumasysþ      * Date: June 12, 2018þ      * Description: WPLATFORM OBJþ      *þ      **********************************************************************þ      *þ      *þ      * PLATFORMOBJþ      *þ      * {þ      *   "platform":" WINDOWS OR LINUX",þ      *   "mvtype"  :" JBASE, D3, UNIDATA, UNIVERSE, OPENQM",þ      *   "tmpdir"  :"tmp dir"þ      * }þþ      * nEW lINEþþ      INCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþ      þ      USE.DICT=1þ      þ      INCLUDE MVDBTOOLKIT.VALIDATE.CONFIG.INCLUDEþ      þ      OPEN "MVDB.CONTROL" TO F.CONFIG ELSEþ         PRINT "Could not open MVDB.CONTROL"þ         PLATFORMOBJ=''þ         STOPþ      ENDþ      þ      READ PLATFORMOBJ.JSON FROM F.CONFIG, "MV.PLATFORM.JSON"  ELSE PLATFORMOBJ.JSON=''þ      þ      USE.DICT=0þþ      OPEN "MD" TO FI.MD ELSEþ         OPEN "VOC" TO FI.MD ELSE RETURNþ      ENDþþ      * 02/06/2020 - Changed md item name to MV.PLATFORM.JSON to make it not tied to this packageþ      þ      IF PLATFORMOBJ.JSON="" THENþ         CRT "No MV.PLATFORM.JSON IN MD!!!"þ         STOPþ      ENDþþ      CONVERT CHAR(254) TO '' IN PLATFORMOBJ.JSONþ      CALL @WOBJ.RTNE(PLATFORMOBJ,"FROMSTRING","",PLATFORMOBJ.JSON,"",RERR)þþ      * 9/2/2019 PAP - We now figure out filedelim vs passing it in original config filedelimþþ      CALL @WOBJ.RTNE(PLATFORMOBJ,"GET","platform",PLATFORM,"",RERR)þ      CALL @WOBJ.RTNE(PLATFORMOBJ,"GET","mvtype",MV.TYPE,"",RERR)þ      IF PLATFORM="WINDOWS" THEN DELIM = "\" ELSE DELIM = "/"þ      CALL @WOBJ.RTNE(PLATFORMOBJ,"SET","filedelim",DELIM,"",RERR)þ      CALL @WOBJ.RTNE(PLATFORMOBJ,"GET","tmpdir",TMP.DIR,"",RERR)þþ      CALL @WOBJ.RTNE(PLATFORMOBJ,"TOSTRING","",OUT.JSON,"PRETTIFY",RERR)þ      WRITE OUT.JSON ON F.CONFIG, "MV.PLATFORM.JSON"þþ      RETURN00014AMVDBTOOLKIT.GET.CONFIG.ITEMþ0c2* New standalone function that will get a platform config itemþ* and print it outþ*þ* this is to solve for D3 and flash issuesþ*þCMND=SENTENCE()þNODE=FIELD(CMND,' ',2)þIF NODE='' THEN STOPþCALL MVDBTOOLKIT.WPLATFORM(PLATFORMOBJ)þCALL WOBJ(PLATFORMOBJ,"GET",NODE,NODE.VALUE,"",RERR)þPRINT NODE.VALUEþ0006FDMVDBTOOLKIT.ENCODEþ0c2SUBROUTINE MVDBTOOLKIT.ENCODE(IN.STR,OUT.STR)þ**********************************************************************þ*þ* Copyright (C) 2017 Zumasys, Inc., All Rights Reservedþ*þ* Written by: Patrick Payne, Zumasysþ* Date: December 2017þ* Description: encode json stringþ*þ**********************************************************************þ***þ* THIS PROGRAM WILL CONVERT ALL BAD CHARACTERS TO AN ESCAPED CHARACTERþ***þEQU CR TO CHAR(13), LF TO CHAR(10), TB TO CHAR(9), BS TO CHAR(8), FF TO CHAR(12)þNL = CR:LFþþPRETTIFYCR=""þ*þ*OPEN 'RESULT.FILE' TO RFILE ELSE STOPþ* WE NEED TO ENCODEþ* " = \"   (34)þ* \ = \\    (92)þ* / = \/þ* CHAR(7) = \bþ* CHAR(13) = \rþ* char(10) = \nþ* char(12) = \fþ* char(9)  = \tþOUT.STR=''þL=LEN(IN.STR)þCONVERT @AM TO LF IN IN.STR; * LETS SWITCH 254 TO LF BE DEFAULTþFOR X=1 TO Lþ    C=IN.STR[X,1]þ    SEQ.C=SEQ(C)þ    ENCODE=0þ    *IF SEQ.C < 32 THEN ENCODE=1; * BELOW SPACEþ    *IF SEQ.C > 32 AND SEQ.C < 48 THEN ENCODE=1; * LETS ENCODE ALL OF THIS !@$%^&*()þ    IF SEQ.C=33 THEN ENCODE=1; * !þ    IF SEQ.C=34 THEN ENCODE=1; * "þ    IF SEQ.C=92 THEN ENCODE=1; * \þ    * IF SEQ.C=47 THEN ENCODE=1þ    *IF SEQ.C > 126 THEN ENCODE = 1; * LETS ENCODE ALL THE HIGH ENTRIESþ    *IF SEQ.C >= 91 AND SEQ.C <= 96 THEN ENCODE=1þ    IF ENCODE THENþ        BEGIN CASEþ            CASE SEQ.C=7; OUT.STR='\b'þ            CASE C='\'; OUT.STR:='\\'þ                *CASE C='/'; OUT.STR:='\/'þ            CASE C='"'; OUT.STR:='\"'þ            CASE SEQ.C=10þ                OUT.STR:='\n'þ                IF PRETTIFYCR THEN OUT.STR:=NLþ            CASE SEQ.C=13; OUT.STR:='\r'þ            CASE SEQ.C=12; OUT.STR:='\f'þ            CASE 1; OUT.STR:='\u00':OCONV(C,'MX0C')þ        END CASEþ    END ELSEþ        OUT.STR=OUT.STR:Cþ    ENDþNEXT XþRETURNþEND002EC5MVDBTOOLKIT.WCALLþ0c2    SUBROUTINE MVDBTOOLKIT.WCALL(PASSED.WOBJ)þ**********************************************************************þ*þ* Copyright (C) 2018 Zumasys, Inc., All Rights Reservedþ*þ* Written by: Patrick Payne, Zumasysþ* Date: June 15, 2018þ* Description: WCALL Libraryþþ**********************************************************************þ*þ* @WOBJ.RTNEþ* { "method":"GET,PUT,POST,ETC",þ*    "url":"URL TO CALL",þ*    "headers": { "HEADERNAME":"VALUE", "HEADERNAME":"VALUE" },þ*    "outputfile: "Optional output file, wcall will write the output to this file vs response.data",þ*    "body":"BODY",þ*    "formfields": [þ*         {þ*            "name":"field name",þ*            "value":"field value",þ*            "fieldtype":"blank or file" for nowþ*         }þ*     ],þ*    "datafields": [þ*         {þ*            "name":"field name",þ*            "value":"field value",þ*            "fieldtype":"blank or file" for nowþ*         }þ*     ],þ*    "insecure":"Yes,Y,YES - Sets the -k on curl",þ*    "timeout": ## (default is 45),þ*    "options":"options to add to curl command",þ*    "debug":"Y or N",þ*    "response": {þ*        "result":"RESULT",þ*        "status":"STATUS",þ*        "statusmsg":"STATUS MSG",þ*        "http_type": "http type",þ*        "curl_cmnd":"Actual curl command created",þ*         "error": "error",þ*         "log": [ "log output line1", "log output line 2" ],þ*        "headers": { "headername":"header value","headername2":"headervalue" }þ*    }þ*  }þ    INCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþþ    CALL MVDBTOOLKIT.WPLATFORM(POBJ)þþ    CALL @WOBJ.RTNE(POBJ,"GET","mvtype",MV.TYPE,"",RERR)þ    CALL @WOBJ.RTNE(POBJ,"GET","platform",PLATFORM,"",RERR)þ    CALL @WOBJ.RTNE(POBJ,"GET","filedelim",FILE.DELIM,"",RERR)þ    CALL @WOBJ.RTNE(POBJ,"GET","curllocation",CURLLOCATION,"",RERR)   ;* change #19þþ    IF MV.TYPE="" THENþ        CALL @WOBJ.RTNE(POBJ,"GET","error",THIS.ERROR,"",RERR)þ        PRINT "NO MV TYPE: ":THIS.ERRORþ        RETURNþ    ENDþþ    ITEMS.TO.DELETE=""        ;* PATH TO EACH FILE TO DELETEþþ    CALL @WOBJ.RTNE(POBJ,"GET","tmpdir",TMP.DIR,"",RERR)þþ    CALL @WOBJ.RTNE(PASSED.WOBJ,"GET","debug",DO.DEBUG,"",RERR)þ    IF OCONV(DO.DEBUG[1,1],"MCU")="Y" OR DO.DEBUG="1" THEN DO.DEBUG=1 ELSE DO.DEBUG=""þ    CALL @WOBJ.RTNE(PASSED.WOBJ,"GET","method",WEB.METHOD,"",RERR)þ* 7/22/2020 PAP Set default Methodþ    IF WEB.METHOD="" THEN WEB.METHOD="GET"þþ    CALL @WOBJ.RTNE(PASSED.WOBJ,"GET","url",WEB.URL,"",RERR)þ    CALL @WOBJ.RTNE(PASSED.WOBJ,"GET","body",WEB.BODY,"",RERR)þ    CALL @WOBJ.RTNE(PASSED.WOBJ,"GET","timeout",WEB.TIMEOUT,"",RERR)þ    CALL @WOBJ.RTNE(PASSED.WOBJ,"KEYS","headers",WEB.HEADERS,"",RERR)þ    IF NOT(WEB.TIMEOUT) THEN WEB.TIMEOUT=45þ    CALL @WOBJ.RTNE(PASSED.WOBJ,"GET","insecure",WEB.INSECURE,"",RERR)þ    IF OCONV(WEB.INSECURE[1,1],'MCU') = "Y" THEN WEB.INSECURE=1 ELSE WEB.INSECURE=0þþ    CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.OBJECT","response","{}","",RERR)þþ    IF TMP.DIR="" THENþ        BEGIN CASEþ        CASE PLATFORM="LINUX"þ            TMP.DIR="/tmp"þ        CASE INDEX(PLATFORM,"WINDOWS",1) AND MV.TYPE="JBASE"þ            TMP.DIR="%HOME%"þ        CASE INDEX(PLATFORM,"WINDOWS",1)þ            TMP.DIR="%USERPROFILE%\AppData\Local\Temp"þ        CASE 1þ            TMP.DIR="/tmp"þ        END CASEþ    ENDþþ    CALL MVDBTOOLKIT.EXPAND.PATH(TMP.DIR)þþ* 4/6/2020 - Change #19.þ    IF CURLLOCATION # "" THENþ        CMND=CURLLOCATIONþ    END ELSEþ        CMND="curl"þ    ENDþ    CMND:=" -s"þ    CMND:=' -m ':WEB.TIMEOUTþ    CMND:=' -X ':WEB.METHODþ    CALL @WOBJ.RTNE(PASSED.WOBJ,"GET","options",WEB.OPTIONS,"",RERR)þ    IF WEB.OPTIONS # "" THENþ        CMND:=' ':WEB.OPTIONSþ    ENDþþ    WEB.NUM.HEADERS=DCOUNT(WEB.HEADERS,@SVM)þþ    FOR H=1 TO WEB.NUM.HEADERSþ        HEADER.NAME=WEB.HEADERS<1,1,H>þ        CALL @WOBJ.RTNE(PASSED.WOBJ,"GET","headers.":HEADER.NAME,HEADER.VALUE,"",RERR)þ        CALL MVDBTOOLKIT.ENCODE(HEADER.VALUE,ENCODED.HEADER.VALUE)þ        CMND:=' -H "':HEADER.NAME:': ':ENCODED.HEADER.VALUE:'"'þ    NEXT Hþþ    USER.NO=FIELD(OCONV('','U50BB'),' ',1)þ    SESSION.ID="WCALL-":USER.NOþþ    TMP.DIR:=FILE.DELIMþþ* add in dumping of headersþ    CMND:=\ -D "\:TMP.DIR:SESSION.ID:\.headers"\þþ    ITEMS.TO.DELETE<-1>=TMP.DIR:SESSION.ID:'.headers'þþ* write out stderrþ    CMND:=\ -v --stderr "\:TMP.DIR:SESSION.ID:\.stderr"\þþ    ITEMS.TO.DELETE<-1>=TMP.DIR:SESSION.ID:\.stderr\þþ    CALL @WOBJ.RTNE(FOBJ,"FROMSTRING","","{}","",RERR)þþ    SAVE.FOBJ=FOBJþþ    IF WEB.BODY # "" THENþ*CALL @WOBJ.RTNE(EOBJ,"SET.ARRAY","data","[]","",RERR)þ*CALL @WOBJ.RTNE(EOBJ,"SET.STRING","data[0]",WEB.BODY,"",RERR)þþþ        CALL @WOBJ.RTNE(FOBJ,"SET","action","WRITE","",RERR)þ        CALL @WOBJ.RTNE(FOBJ,"SET","data",WEB.BODY,"",RERR)þ        CALL @WOBJ.RTNE(FOBJ,"SET","path",TMP.DIR:SESSION.ID:'.body',"",RERR)þ        ITEMS.TO.DELETE<-1>=TMP.DIR:SESSION.ID:'.body'þþ        CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ        CMND:=' --data-binary "@':TMP.DIR:SESSION.ID:'.body"'þ*CMND:='  --data-binary @-'þ    ENDþþ* form fields *þ    CALL @WOBJ.RTNE(PASSED.WOBJ,"LENGTH","formfields",NUM.FORMFIELDS,"",RERR)þþ    FOR X=1 TO NUM.FORMFIELDSþ        P="formfields[":X-1:"]"þ        CALL @WOBJ.RTNE(PASSED.WOBJ,"GET",P:'.name',FIELD.NAME,"",RERR)þ        CALL @WOBJ.RTNE(PASSED.WOBJ,"GET",P:'.value',FIELD.VALUE,"",RERR)þ        CALL @WOBJ.RTNE(PASSED.WOBJ,"GET",P:'.fieldtype',FIELD.TYPE,"",RERR)þ        IF TRIM(FIELD.NAME) # "" THENþ* < > @ ALL MEAN SPECIAL THINGS WITH A -F.  If that exists in the file you needþ* to use --form-stringþ            BEGIN CASEþ            CASE INDEX(FIELD.VALUE,CHAR(13),1) OR INDEX(FIELD.VALUE,CHAR(10),1)þ* WE NEED TO WRITE THIS OUT!þ                TMP.CMND="-F "þ                CALL @WOBJ.RTNE(FOBJ,"SET","action","WRITE","",RERR)þ                CALL @WOBJ.RTNE(FOBJ,"SET","data",FIELD.VALUE,"",RERR)þ                CALL @WOBJ.RTNE(FOBJ,"SET","path",TMP.DIR:SESSION.ID:'.field':X-1,"",RERR)þ                ITEMS.TO.DELETE<-1>=TMP.DIR:SESSION.ID:'.field':X-1þ                FIELD.VALUE="@":TMP.DIR:SESSION.ID:'.field':X-1þ                CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ* NEED TO WRITE THE CONTENT OUT TO A TMP FILE *þþ            CASE INDEX(FIELD.VALUE,'!',1) OR INDEX(FIELD.VALUE,'<',1) OR INDEX(FIELD.VALUE,'>',1) OR INDEX(FIELD.VALUE,'@',1) OR INDEX(FIELD.VALUE,'$',1) AND FIELD.TYPE # "file"þ                TMP.CMND="--form-string "þ            CASE 1þ                TMP.CMND="-F "þ            END CASEþ            TMP.CMND:=FIELD.NAME:'="'þ            TMP.CMND:=FIELD.VALUE:'"'þ            CMND:=' ':TMP.CMNDþ        ENDþ    NEXT Xþþ* form fields *þ    CALL @WOBJ.RTNE(PASSED.WOBJ,"LENGTH","datafields",NUM.FORMFIELDS,"",RERR)þþ    FOR X=1 TO NUM.FORMFIELDSþ        P="datafields[":X-1:"]"þ        CALL @WOBJ.RTNE(PASSED.WOBJ,"GET",P:'.name',FIELD.NAME,"",RERR)þ        CALL @WOBJ.RTNE(PASSED.WOBJ,"GET",P:'.value',FIELD.VALUE,"",RERR)þ        CALL @WOBJ.RTNE(PASSED.WOBJ,"GET",P:'.fieldtype',FIELD.TYPE,"",RERR)þ        CALL MVDBTOOLKIT.SWAP(FIELD.VALUE,'@','%40')þ        CALL MVDBTOOLKIT.SWAP(FIELD.VALUE,'$','%24')þ        CALL MVDBTOOLKIT.SWAP(FIELD.VALUE,'/','%2F')þ        CALL MVDBTOOLKIT.SWAP(FIELD.VALUE,':','%3A')þþ        IF TRIM(FIELD.NAME) # "" THENþ            TMP.CMND="-d "þ            TMP.CMND:=FIELD.NAME:'="'þ            TMP.CMND:=FIELD.VALUE:'"'þ            CMND:=' ':TMP.CMNDþ        ENDþ    NEXT Xþ* NOW ADD THE URLþþ    CALL MVDBTOOLKIT.SWAP(WEB.URL,' ','%20')þ    CALL MVDBTOOLKIT.SWAP(WEB.URL,'@','%40')þ    CALL MVDBTOOLKIT.SWAP(WEB.URL,'$','%24')þ*WEB.URL=SWAP(WEB.URL,'/','%2F')þþ    CMND:=' "':WEB.URL:'"'þþ* CALL WEXECUTEþþ    CALL @WOBJ.RTNE(EOBJ,"FROMSTRING","","{}","",RERR)þþ    CALL @WOBJ.RTNE(EOBJ,"SET","command",CMND,"",RERR)þ    CALL @WOBJ.RTNE(EOBJ,"SET","debug",DO.DEBUG,"",RERR)    ;* LAY IN DEBUGGING PARAMþþ    IF WEB.BODY # "" THENþ* CALL @WOBJ.RTNE(EOBJ,"SET","data[0]",WEB.BODY,"",RERR)þ    ENDþþ    CALL MVDBTOOLKIT.WEXECUTE(EOBJ)     ;* DO THE CALLþþ* READ IN THE HEADERSþþ    CALL @WOBJ.RTNE(FOBJ,"FROMSTRING","","{}","",RERR)þ    CALL @WOBJ.RTNE(FOBJ,"SET","action","READ","",RERR)þ    CALL @WOBJ.RTNE(FOBJ,"SET","path",TMP.DIR:SESSION.ID:".headers","",RERR)þ    CALL @WOBJ.RTNE(FOBJ,"SET","newline","MV","",RERR)þ    CALL MVDBTOOLKIT.WFILEIO(FOBJ)þþ    CALL @WOBJ.RTNE(FOBJ,"GET","response.data",RESPONSE.HEADERS,"",RERR)þþ*    CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.STRING","response.headers",RESPONSE.HEADERS,"",RERR)þþ* Lets break the headers down into an arrayþþ    CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.OBJECT","response.headers","{}","",RERR)þþ    NUM.HEADERS=DCOUNT(RESPONSE.HEADERS,@AM)þþ    HTTP.TYPE=''; HTTP.STATUS.CODE=''; HTTP.MSG=''þþ    FOR H=1 TO NUM.HEADERSþ        HEADER.LINE=RESPONSE.HEADERS<H>þ        BEGIN CASEþ        CASE HEADER.LINE[1,4]="HTTP" AND NOT(INDEX(HEADER.LINE,":",1))þ            IF INDEX(HEADER.LINE,' 200 ',1) THENþ                HTTP.TYPE=FIELD(HEADER.LINE,' ',1)þ                HTTP.STATUS.CODE=FIELD(HEADER.LINE,' ',2)þ                HTTP.STATUS.MSG=FIELD(HEADER.LINE,' ',3,99)þ            ENDþ        CASE TRIM(HEADER.LINE)=''       ;* NOTHINGþ        CASE 1þ            HEADER.NAME=TRIM(FIELD(HEADER.LINE,':',1))þ            CONVERT CHAR(13):CHAR(10) TO '' IN HEADER.NAME  ;* CATCHES BLANK LINESþ            HEADER.VALUE=FIELD(HEADER.LINE,':',2,999999)þ            IF  HEADER.VALUE[1,1]=' ' THEN HEADER.VALUE=HEADER.VALUE[2,LEN(HEADER.VALUE)] ;* messy left trimþ            CONVERT CHAR(13):CHAR(10) TO '' IN HEADER.VALUE ;* STRIP AN NEW LINESþ            IF HEADER.NAME # "" THENþ* NOW PUT THE HEADER INTO OUR ARRAYþ                CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.STRING","response.headers.":HEADER.NAME,HEADER.VALUE,"",RERR)þ            ENDþ        END CASEþ    NEXT Hþþ    CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.NUMBER","response.status",HTTP.STATUS.CODE,"",RERR)þ    CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.STRING","response.http_type",HTTP.TYPE,"",RERR)þ    CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.STRING","response.statusmsg",HTTP.STATUS.MSG,"",RERR)þþ* READ IN STDERR (LOG) AND POST AS A ARRAYþþ    FOBJ=SAVE.FOBJþ    CALL @WOBJ.RTNE(FOBJ,"SET","action","READ","",RERR)þ    CALL @WOBJ.RTNE(FOBJ,"SET","path",TMP.DIR:SESSION.ID:'.stderr',"",RERR)þ    CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ    CALL @WOBJ.RTNE(FOBJ,"GET","response.data",RESPONSE.STDERR,"",RERR)þþ    CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.ARRAY","response.log","[]","",RERR)þþ    CONVERT CHAR(13) TO @AM IN RESPONSE.STDERRþ    CONVERT CHAR(10) TO "" IN RESPONSE.STDERRþ    NUM.LINES=DCOUNT(RESPONSE.STDERR,@AM)þþ* 4/2/2020 pap  - Look for bad curl statement!!þþ    GOOD.CURL=1þ    CURL.BAD.MSG=""þþ    FOR L=1 TO NUM.LINESþ        LINE=RESPONSE.STDERR<L>þ        BEGIN CASEþ        CASE INDEX(LINE,'curl:',1)þ* LETS CAPTURE THE FIRST ONEþ            IF CURL.BAD.MSG = "" THEN CURL.BAD.MSG=TRIM(FIELD(LINE,':',2,999))þ            GOOD.CURL=0þ        CASE INDEX(LINE,'warning:',1)þ        END CASEþ        CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.STRING","response.log[-1]",LINE,"",RERR)þ    NEXT Lþþ    IF NOT(GOOD.CURL) THENþ        CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.NUMBER","response.status","400","",RERR)þ        CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.STRING","response.statusmsg",CURL.BAD.MSG,"",RERR)þ    ENDþþ*CALL @WOBJ.RTNE(EOBJ,"TOSTRING","",TEST.JSON,"PRETTIFY",RERR)þ    CALL @WOBJ.RTNE(EOBJ,"GET","result.result",EXECUTE.RESULT,"",RERR)þ    CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.STRING","response.data",EXECUTE.RESULT,"",RERR)þþend.of.call:        *þþ* XDELETE REQUIRED FILESþþ    NUM.ITEMS.TO.DELETE=DCOUNT(ITEMS.TO.DELETE,@AM)þþ    FOR I=1 TO NUM.ITEMS.TO.DELETEþ        ITEM.TO.DELETE=ITEMS.TO.DELETE<I>þ        FOBJ=SAVE.FOBJþ        CALL @WOBJ.RTNE(FOBJ,"SET","action","DELETE","",RERR)þ        CALL @WOBJ.RTNE(FOBJ,"SET","path",ITEM.TO.DELETE,"",RERR)þ        IF DO.DEBUG THENþ            CRT "Normally trying to delete: ":ITEM.TO.DELETEþ        END ELSEþ            CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ        ENDþ    NEXT Iþþ    CALL @WOBJ.RTNE(PASSED.WOBJ,"SET.STRING","response.curl_cmnd",CMND,"",RERR)þþ    RETURN0004BFMVDBTOOLKIT.WEXECUTE.UNIDATAþ0c2SUBROUTINE MVDBTOOLKIT.WEXECUTE.UNIDATA(EOBJ)þINCLUDE MVDBTOOLKIT.WEXECUTE.INCLUDEþ**********************************************************************þ*þ* Copyright (C) 2017 Zumasys, Inc., All Rights Reservedþ*þ* Written by: Patrick Payne, Zumasysþ* Date: June 12, 2018þ* Description: Execute library UNIDATA VERSION - CLONED FROM D3 VERSIONþ*þ**********************************************************************þþINCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþþE.RESULTS=""þE.RETURNING=""þE.RTNDATA=""þþBEGIN CASEþ    CASE EXECUTE.DOCAPTURE="N"þ        EXECUTE '!':EXECUTE.COMMAND þ    CASE 1þ        EXECUTE '!':EXECUTE.COMMAND CAPTURING E.RESULTþEND CASEþþIF EXECUTE.DEBUG="1" OR OCONV(EXECUTE.DEBUG[1,1],'MCU')='Y' THENþ   WRITE.DEBUG=1þ   OPEN 'RESULT.FILE' TO RFILE ELSE WRITE.DEBUG=0þ   IF WRITE.DEBUG THENþ       WRITE EXECUTE.COMMAND ON RFILE, 'WEXECUTE'þ   ENDþENDþþCONVERT CHAR(0) TO '' IN E.RESULTþCONVERT CHAR(255) TO '' IN E.RESULTþþCALL MVDBTOOLKIT.WPLATFORM(PLATFORMOBJ)þþCALL @WOBJ.RTNE(PLATFORMOBJ,"GET","mvtype",MV.TYPE,"",RERR)þþIF MV.TYPE='UNIDATA' THEN E.RESULT=E.RESULT[1,LEN(E.RESULT)-1]þþCALL @WOBJ.RTNE(EOBJ,"SET.STRING","result.result",E.RESULT,"",RERR)þþRETURN00018CMVDBTOOLKIT.WOBJ.CHOOSE.WOBJþ0c2* Code to determine default wobj library to useþþ* This needs to change for MVDBTOOLKIT build, defaults to WOBJþþWOBJ.RTNE="WOBJ"þþNO.MD.FILE=0þþOPEN "MD" TO FILE.MD ELSEþ    OPEN "VOC" TO FILE.MD ELSE NO.MD.FILE=1þENDþþIF NOT(NO.MD.FILE) THENþ    READ WOBJ.CONF FROM FILE.MD, "WOBJ.CONF" ELSE WOBJ.CONF=""þþ    IF WOBJ.CONF<3> # "" THEN WOBJ.RTNE=WOBJ.CONF<3>þEND000F96MVDBTOOLKIT.PACKAGE.INSTALLER.SUBþ0c2SUBROUTINE MVDBTOOLKIT.PACKAGE.INSTALLER.SUB(PACKAGE,RESULT)þþ      * Install packagesþþ      * first, get a list of packagesþþ      CALL WOBJ(COBJ,"FROMJSON","","{}","",RERR)þþ      CALL MVDBTOOLKIT.WPLATFORM(PLATFORM.OBJ)þþ      CALL WOBJ(PLATFORM.OBJ,"GET","packagesurl",PACKAGES.URL,"",RERR)þþ      IF PACKAGES.URL = "" THENþ         PACKAGES.URL="https://raw.githubusercontent.com/zumasys/MVConnect/master/packages.json"þ      ENDþþ      CALL WOBJ(PLATFORM.OBJ,"GET","mvtype",MVTYPE,"",RERR)þ      þ      MVTYPE=OCONV(MVTYPE,"MCU")þ      þ      BEGIN CASEþ         CASE MVTYPE="D3"; MVTYPE2="d3"þ         CASE MVTYPE="JBASE"; MVTYPE2="jb"þ         CASE MVTYPE="QM"; MVTYPE2="qm"þ         CASE MVTYPE="UNIVERSE"; MVTYPE2="uv"þ         CASE MVTYPE="UNIDATA"; MVTYPE2="ud"þ         CASE 1þ             PRINT "Platform ":MVTYPE:" not supported"þ             RETURNþ      END CASEþ      þ      CALL WOBJ(PLATFORM.OBJ,"GET","tmpdir",TMP.DIR,"",RERR)þ      þ      CALL WOBJ(PLATFORM.OBJ,"GET","filedelim",FILEDELIM,"",RERR)þ      þ      *PRINT "Packages url: ":PACKAGES.URLþþ      CALL WOBJ(COBJ,"SET","url",PACKAGES.URL,"",RERR)þ      CALL WOBJ(COBJ,"SET","method","GET","",RERR)þþ      *CRT "Getting package list...":þþ      CALL MVDBTOOLKIT.WCALL(COBJ)þþ      *CALL MVDBTOOLKIT.WCALL.DEBUG(COBJ)þþþ      CALL WOBJ(COBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þþ      CALL WOBJ(COBJ,"GET","response.statusmsg",RESPONSE.STATUS.MSG,"",RERR)þ      CALL WOBJ(COBJ,"GET","response.data",RESPONSE.DATA,"",RERR)þþ      *PRINT RESPONSE.STATUS:' ':RESPONSE.STATUS.MSGþþ      CALL WOBJ(POBJ,"FROMJSON","",RESPONSE.DATA,"",RERR)þþ      IF RERR>0 THENþ         PRINT RERR<1>:" Error: ":RERR<2>þ         RETURNþ      ENDþþ      CALL WOBJ(POBJ,"LENGTH","packages",NUMBER.PACKAGES,"",RERR)þþ      *PRINT "Number packages: ":NUMBER.PACKAGESþþtop.of.packages: *þþ      PACKAGES=""þ      þ      FOR P=1 TO NUMBER.PACKAGESþþ         CALL WOBJ(POBJ,"GET","packages[":P-1:"].name",PACKAGE.NAME,"",RERR)þ         CALL WOBJ(POBJ,"GET","packages[":P-1:"].version",PACKAGE.VERSION,"",RERR)þþ       *  PRINT P"MR(#4)":þ       *  PRINT " ":þ       *  PRINT PACKAGE.NAME:þ         PACKAGES<P>=PACKAGE.NAMEþ         þ       *  PRINT " ":þ       *  PRINT PACKAGE.VERSIONþ      NEXT Pþþ      *PRINT "Package # to install or return to quit ":; INPUT PACKAGEþ      þ      IF PACKAGE="" THEN STOPþ      IF NOT(NUM(PACKAGE)) THENþ           LOCATE PACKAGE IN PACKAGES SETTING PACKAGE ELSE STOPþ      ENDþ      þ      IF PACKAGE < 1 OR PACKAGE > NUMBER.PACKAGES THEN STOPþþ      CALL WOBJ(POBJ,"GET","packages[":PACKAGE-1:"].name",PACKAGE.NAME,"",RERR)þ      CALL WOBJ(POBJ,"GET","packages[":PACKAGE-1:"].version",PACKAGE.VERSION,"",RERR)þþ      PRINT "Installing ":PACKAGE.NAME:" ":PACKAGE.VERSIONþ      þ      PRINT "Platform ":MVTYPE:' ':MVTYPE2þ      PRINT "Temp Directory: ":TMP.DIRþ      PRINT "O/S delim: ":FILEDELIMþ      þ      COBJ=""þ      CALL WOBJ(COBJ,"FROMSTRING","","{}","",RERR)þ      þ      PACKAGE.FILE.NAME=PACKAGE.NAME:"-":MVTYPE2:".pkg"þ      þ      URL="https://raw.githubusercontent.com/zumasys/MVConnect/master/packages/":MVTYPE2þ      URL:="/":PACKAGE.FILE.NAMEþ      þ      PRINT URLþ      þ      FULL.PACKAGE.PATH=TMP.DIR:FILEDELIM:PACKAGE.FILE.NAMEþ      þ      PRINT "Downloading ":URL:" to ":FULL.PACKAGE.PATHþ      þ      CALL WOBJ(COBJ,"SET","url",URL,"",RERR)þ      CALL WOBJ(COBJ,"SET","method","GET","",RERR)þ      OUTFILE.NAME='"':TMP.DIR:FILEDELIM:PACKAGE.FILE.NAME:'"'þ      CALL WOBJ(COBJ,"SET","options"," -o ":OUTFILE.NAME,"",RERR)þ      þ      CALL MVDBTOOLKIT.WCALL(COBJ)þ      *CALL MVDBTOOLKIT.WCALL.DEBUG(COBJ)þ      þ      CALL WOBJ(COBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þþ      CALL WOBJ(COBJ,"GET","response.statusmsg",RESPONSE.STATUS.MSG,"",RERR)þ      þ      PRINT "Response: ":RESPONSE.STATUS,RESPONSE.STATUS.MSGþ      þ      DATA FULL.PACKAGE.PATHþ      EXECUTE 'MVDBTOOLKIT.APP.INSTALLER'þ      þ      þRETURNþþ00017AMVDBTOOLKIT.SWAP.UNIDATAþ0c2SUBROUTINE MVDBTOOLKIT.SWAP.UNIVERSE(V,F,T)þþIF F=T THEN RETURNþIF F='' THEN RETURNþREMAINING.STRING=VþV=''þþCNTR=0þLOOPþ   CNTR+=1þ   POS=INDEX(REMAINING.STRING,F,1)þUNTIL NOT(POS) DOþ   PRE.STRING=REMAINING.STRING[1,POS-1]þ   REMAINING.STRING=REMAINING.STRING[POS+LEN(F),LEN(REMAINING.STRING)]þ   V:=PRE.STRING:TþREPEATþV:=REMAINING.STRINGþþRETURNþ0041E5MVDBTOOLKIT.CONFIGþ0c2      PRINT @(-1):"MVDBTOOLKIT.CONFIG"þ      PRINTþþ      COMMON /MVMKCOM/ MVMAKE.SUB.COMMON.INFOþþ      MVMAKE.SUB.COMMON.INFO=""; * DO NOT USE FOR THIS VERSIONþþ      IF MVMAKE.SUB.COMMON.INFO="" OR MVMAKE.SUB.COMMON.INFO = "0" THENþ         *    CRT "MVDBTOOLKIT.CONFIG MUST BE CALLED FROM MVMAKE"þ         *    STOPþ      ENDþþ      INCLUDE MVDBTOOLKIT.TEST.INCLUDEþþ      INCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþþ      * 9/22/2020 - Changing the location of all config files to MVDB.CONTROLþ      *þ      *             Same rules.  This program will create the file if needed.þþ      INCLUDE MVDBTOOLKIT.VALIDATE.CONFIG.INCLUDEþþ      OPEN "MVDB.CONTROL" TO F.CONFIG ELSEþ         PRINT "Could not open MVDB.CONTROL!"þ         STOPþ      ENDþ      READ MVCONNECT.ACCOUNT FROM F.CONFIG, "MVCONNECT.ACCOUNT" ELSE MVCONNECT.ACCOUNT=""þ      IF TRIM(MVCONNECT.ACCOUNT<1,1,1>)='' THENþ         EXECUTE "WHO" CAPTURING W.RESULTþ         MVCONNECT.ACCOUNT=FIELD(W.RESULT,' ',3)þ         IF TRIM(MVCONNECT.ACCOUNT)="" THEN MVCONNECT.ACCOUNT=FIELD(W.RESULT,' ',2)þ         WRITE MVCONNECT.ACCOUNT<1,1,1> ON F.CONFIG, "MVCONNECT.ACCOUNT"þ      ENDþþþ      READ PLATFORM.JSON FROM F.CONFIG, "MV.PLATFORM.JSON" ELSE PLATFORM.JSON="{}"þ      IF TRIM(PLATFORM.JSON) = "" THEN PLATFORM.JSON="{}"þþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"FROMSTRING","",PLATFORM.JSON,"",RERR)þþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","platform",PLATFORM,"",RERR)þ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","mvtype",MVTYPE,"",RERR)þþ      IF MVMAKE.SUB.COMMON.INFO<2> # "" THEN PLATFORM=MVMAKE.SUB.COMMON.INFO<2>þ      IF MVMAKE.SUB.COMMON.INFO<3> # "" THEN MVTYPE=MVMAKE.SUB.COMMON.INFO<3>þþþþ      IF PLATFORM="" OR MVTYPE="" THENþ         ** LETS FIGURE OUT THE PLATFORM **þ         EXECUTE 'jdiag' CAPTURING RESULTþ         RESULT=OCONV(RESULT,"MCU")þ         IF INDEX(RESULT,'JBASE',1) THENþ            MVTYPE="JBASE"þ            OS.POS=INDEX(RESULT,"OS RELEASE",1)þ            OS.TYPE=RESULT[OS.POS,9999]þ            OS.TYPE=OS.TYPE<1,1,1>þ            OS.TYPE=OCONV(OS.TYPE,"MCU")þ            IF INDEX(OS.TYPE,"WINDOWS",1) THENþ               PLATFORM="WINDOWS"þ            END ELSEþ               PLATFORM="LINUX"þ            ENDþ            GOTO end.of.mvtypeþ         ENDþþ         EXECUTE 'WHICH' CAPTURING RESULTþ         RESULT=OCONV(RESULT,"MCU")þ         IF INDEX(RESULT,"D3",1) THENþ            MVTYPE="D3"þ            IF INDEX(RESULT,"WINDOWS",1) THENþ               PLATFORM="WINDOWS"þ            END ELSEþ               PLATFORM="LINUX"þ            ENDþ            GOTO end.of.mvtypeþ         ENDþþ         EXECUTE 'CT ERRMSG 335 (N' CAPTURING RESULTþ         IF INDEX(OCONV(RESULT,"MCU"),"MVBASE",1) THENþ            MVTYPE="MVBASE"; * NOT SUPPORTEDþ            GOTO end.of.mvtypeþ         ENDþþ         EXECUTE "VERSION" CAPTURING RESULTþ         IF INDEX(OCONV(RESULT,"MCU"),"UNIDATA",1) THENþ            MVTYPE="UNIDATA"þ            EXECUTE '!SET' CAPTURING OS.TYPEþ            OS.TYPE=OCONV(OS.TYPE,'MCU')þ            IF INDEX(OS.TYPE,"WINDIR",1) THENþ               PLATFORM="WINDOWS"þ            END ELSEþ               PLATFORM="LINUX"þ            ENDþ            GOTO end.of.mvtypeþ         ENDþþ         EXECUTE "CT VOC QM.ACCOUNTS" CAPTURING RESULTþ         IF INDEX(OCONV(RESULT,"MCU"),"QMSYS",1) THENþ            MVTYPE="QM"þ            EXECUTE '!SET' CAPTURING OS.TYPEþ            OS.TYPE=OCONV(OS.TYPE,'MCU')þ            IF INDEX(OS.TYPE,"WINDIR",1) THENþ               PLATFORM="WINDOWS"þ            END ELSEþ               PLATFORM="LINUX"þ            ENDþ            GOTO end.of.mvtypeþ         ENDþþ         EXECUTE 'CT VOC UVPROMPT' CAPTURING RESULTþ         IF INDEX(OCONV(RESULT,"MCU"),"1 V",1) THENþ            MVTYPE="UNIVERSE"þ            EXECUTE 'sh -c "pwd"' CAPTURING RESULTþ            IF INDEX(OCONV(RESULT,"MCU"),"NOT AVAILABLE",1) THENþ               PLATFORM="WINDOWS"þ            END ELSEþ               PLATFORM="LINUX"þ            ENDþ            GOTO end.of.mvtypeþ         ENDþþend.of.mvtype: *þþ         IF PLATFORM="" THENþ            PRINT "NO PLATFORM FOUND"; STOPþ            PRINT "ENTER PLATFORM (LINUX OR WINDOWS)[":PLATFORM:"]: ":; INPUT TMP.ANSþ            IF TMP.ANS # "" THEN PLATFORM=TMP.ANSþþ            PLATFORM=OCONV(PLATFORM,"MCU")þþ            BEGIN CASEþ               CASE PLATFORM="WINDOWS"þ                  D3.PREFIX="dos"þ                  PLATFORM.DELIM="\"þ               CASE PLATFORM="LINUX"þ                  D3.PREFIX="unix"þ                  PLATFORM.DELIM="/"þ               CASE 1þ                  CRT "Invalid Platform ":PLATFORM; STOPþ            END CASEþ         ENDþþ         IF MVTYPE="" THENþ            PRINT "NO MVTYPE FOUND"; STOPþ            PRINT "ENTER MVTYPE (JBASE, QM, D3, UNIVERSE, UNIDATA)[":MVTYPE:"] ":; INPUT TMP.ANSþ            IF TMP.ANS # "" THEN MVTYPE = TMP.ANSþþ            MVTYPE=OCONV(MVTYPE,"MCU")þþ            BEGIN CASEþ               CASE MVTYPE="JBASE"þ               CASE MVTYPE="QM"þ               CASE MVTYPE="D3"þ               CASE MVTYPE="UNIVERSE"þ               CASE MVTYPE="UNIDATA"þ               CASE 1þ                  CRT "Invalid MVTYPE"; STOPþ            END CASEþ         ENDþþ      ENDþþ      MVMAKE.SUB.COMMON.INFO<1>='REBUILD'þ      MVMAKE.SUB.COMMON.INFO<2>=PLATFORMþ      MVMAKE.SUB.COMMON.INFO<3>=MVTYPEþþ      PRINT "Platform:      ":PLATFORMþ      PRINT "MV type :      ":MVTYPEþ      PRINTþþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"SET","platform",PLATFORM,"",RERR)þ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"SET","mvtype",MVTYPE,"",RERR)þþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"SET","platform",MVMAKE.SUB.COMMON.INFO<2>,"",RERR)þ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"SET","mvtype",MVMAKE.SUB.COMMON.INFO<3>,"",RERR)þþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"TOSTRING","",PLATFORM.JSON,"PRETTIFY",RERR)þ      CONVERT CHAR(13) TO @AM IN PLATFORM.JSONþ      CONVERT CHAR(10) TO '' IN PLATFORM.JSONþ      WRITE PLATFORM.JSON ON F.CONFIG, "MV.PLATFORM.JSON"þþ      CALL MVDBTOOLKIT.WPLATFORM(PLATFORM.OBJ)þþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","platform",PLATFORM,"",RERR)þ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","mvtype",MVTYPE,"",RERR)þ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","filedelim",FILEDELIM,"",RERR)þþ      IF PLATFORM = "" THENþ         CRT "No platform configured!!!"; STOPþ      ENDþþ      IF MVTYPE = "" THENþ         CRT "No MVType configured!!!"; STOPþ      ENDþþ      * GET ENVIRONMENTþþ      * Let get our current directoryþ      TEST="pwd"; GOSUB start.testþ      IF OCONV(PLATFORM,"MCU") = "WINDOWS" THENþ         CMND='echo %CD%'þ      END ELSEþ         CMND='pwd'þ      ENDþþ      CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ      CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ      CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þ      CONVERT CHAR(13):CHAR(10) TO '' IN CMND.RESULTþ      TEST.STATUS=1þ      TEST.MSG=CMND.RESULTþ      GOSUB end.testþþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","tmpdir",TMP.PATH,"",RERR)þþ      IF TMP.PATH="" THENþþ         IF MVMAKE.SUB.COMMON.INFO<5>="" THEN MVMAKE.SUB.COMMON.INFO<5>="mvdbtoolkit"þþ         IF MVTYPE="QM" THENþ            EXECUTE '!mkdir TMP'þ         ENDþ         BEGIN CASEþ            CASE MVTYPE="D3" AND PLATFORM="LINUX"þ               * DANG D3 HAS IT'S OWN DANG FILE SYSTEM, LETS JUST CREATE A TMP DIR AND MOVEþ               TMP.PATH="/tmp"þ            CASE MVTYPE="D3" AND PLATFORM="LINUX"þ               TMP.DATH="c:\tmp"þ               EXECUTE '!mkdir c:\tmp'þ            CASE OCONV(MVMAKE.SUB.COMMON.INFO<5>,"MCU") = "MVDBTOOLKIT"þ               * WE HAVE RELATIVE POSITIONINGþ               TMP.PATH=CMND.RESULT:FILEDELIM:"TMP"þ               MVDBTOOLKIT.LOCATION=CMND.RESULTþ            CASE 1þ               TMP.PATH=MVMAKE.SUB.COMMON.INFO<5>:FILEDELIM:"TMP"þ               MVDBTOOLKIT.LOCATION=MVMAKE.SUB.COMMON.INFO<5>þ         END CASEþþ      ENDþþþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"SET","tmpdir",TMP.PATH,"",RERR)þ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"SET","mvdbtoolkitlocation",MVDBTOOLKIT.LOCATION,"",RERR)þ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","curllocation",CURLLOCATION,"",RERR)þþ      TEST='tmpdir'; GOSUB start.testþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","tmpdir",TMP.DIR,"",RERR)þ      TEST.MSG=TMP.DIRþ      TEST.STATUS=1þ      IF TMP.DIR="" THEN TEST.STATUS=0þ      GOSUB end.testþþþ      TEST='MVDBTOOLKIT.SWAP'þ      GOSUB start.testþ      S='TEST LINE TEST LINE'þ      ORIG.STRING=Sþ      CALL MVDBTOOLKIT.SWAP(S,"ES","XX")þ      IF S = "TXXT LINE TXXT LINE" THEN TEST.STATUS=1 ELSE TEST.STATUS=0þ      TEST.MSG=Sþ      GOSUB end.testþþ      * Test 1 Getenvþþ      TEST="getenv"þ      GOSUB start.testþ      CALL MVDBTOOLKIT.WGETENV("PATH",PATH)þ      IF PATH # "" THENþ         TEST.MSG=PATH[1,60]þ         TEST.STATUS=1þ      END ELSEþ         TEST.MSG=""þ         TEST.STATUS=0þ      ENDþ      GOSUB end.testþþ      * Test WEXECUTEþþ      TEST="wexecute"; GOSUB start.testþ      CMND='echo MVDBTOOLKIT.TEST'þþ      CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ      CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ      CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ      IF INDEX(CMND.RESULT,"MVDBTOOLKIT.TEST",1) THENþ         TEST.MSG=CMND.RESULTþ         TEST.STATUS=1þ      END ELSEþ         TEST.MSG=CMND.RESULTþ         TEST.STATUS=0þ      ENDþ      CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ      GOSUB end.testþþ      * Test WFILEIOþþ      TEST="WFILEIO-WRITE"þþ      USER.NO=FIELD(OCONV('','U50BB'),' ',1)þ      GOSUB start.testþ      CALL @WOBJ.RTNE(FOBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(FOBJ,"SET","action","WRITE","",RERR)þ      TMP.FILE.NAME=TMP.DIR:FILEDELIM:'TMP-':USER.NO:'.txt'þ      TEST.MSG=TMP.FILE.NAMEþþ      CALL @WOBJ.RTNE(FOBJ,"SET","path",TMP.FILE.NAME,"",RERR)þ      SAVE.FOBJ=FOBJþ      TMP.DATA=TIMEDATE()þ      CALL @WOBJ.RTNE(FOBJ,"SET","data",TMP.DATA,"",RERR)þ      CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.statusmsg",RESPONSE.STATUS.MSG,"",RERR)þ      TEST.STATUS=RESPONSE.STATUSþ      IF NOT(RESPONSE.STATUS) THEN TEST.MSG:=RESPONSE.STATUS.MSGþ      GOSUB end.testþþ      IF NOT(TEST.STATUS) THEN STOP "Test Failed, no reason to continue"þþ      TEST='WFILEIO-READ'þ      GOSUB start.testþþ      * NOW READ IT BACK INþ      CALL @WOBJ.RTNE(FOBJ,"SET","action","READ","",RERR)þ      CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.data",RESPONSE.DATA,"",RERR)þþ      TEST.MSG="(":TMP.DATA:')=(':RESPONSE.DATA:")"þ      TEST.STATUS=1þ      IF TMP.DATA # RESPONSE.DATA THEN TEST.STATUS=0þ      GOSUB end.testþþ      TEST="WFILEIO-DELETE"; GOSUB start.testþ      FOBJ=SAVE.FOBJþ      CALL @WOBJ.RTNE(FOBJ,"SET","action","DELETE","",RERR)þ      CALL MVDBTOOLKIT.WFILEIO(FOBJ)þþ      FOBJ=SAVE.FOBJþ      CALL @WOBJ.RTNE(FOBJ,"SET","action","READ","",RERR)þ      CALL MVDBTOOLKIT.WFILEIO(FOBJ)þ      RESPONSE.DATA=""þþ      CALL @WOBJ.RTNE(FOBJ,"GET","response.data",RESPONSE.DATA,"",RERR)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)þ      CALL @WOBJ.RTNE(FOBJ,"GET","response.statusmsg",RESPONSE.STATUSMSG,"",RERR)þ      TEST.STATUS=1þ      TEST.MSG=TMP.FILE.NAME:' ':RESPONSE.STATUSþ      IF RESPONSE.STATUS=0 AND RESPONSE.DATA="" THEN NULL ELSE TEST.STATUS=0þ      GOSUB end.testþþ      * Let get our current directoryþ      TEST="pwd"; GOSUB start.testþ      IF OCONV(PLATFORM,"MCU") = "WINDOWS" THENþ         CMND='echo %CD%'þ      END ELSEþ         CMND='pwd'þ      ENDþþ      CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ      CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ      CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ      IF 1 THENþ         TEST.MSG=CMND.RESULTþ         TEST.STATUS=1þ      END ELSEþ         TEST.MSG=CMND.RESULTþ         TEST.STATUS=0þ      ENDþ      CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ      GOSUB end.testþþ      MVDBTOOLKIT.LOCATION = CMND.RESULTþþ      * Lets verify we have curl!!!þþ      IF CURLLOCATION="" THEN CURLLOCATION="curl"þþ      TEST="default curl"; GOSUB start.testþ      CMND=CURLLOCATION:' -V'þþ      CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ      CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ      CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ      CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ      BEGIN CASEþ         CASE INDEX(CMND.RESULT,"libcurl",1) AND 1þ            TEST.MSG=CMND.RESULTþ            TEST.STATUS=1þ         CASE OCONV(PLATFORM,"MCU")="WINDOWS"þ            TEST.MSG=CMND.RESULTþ            CURLLOCATION=""þ            TEST.STATUS=2þ         CASE 1þ            TEST.MSG=0þ      END CASEþþ      CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ      GOSUB end.testþþ      * THIS IS SLOPPY CODEþþ      IF CURLLOCATION="" AND PLATFORM="WINDOWS" THENþ         * Start looking for curlþ         IF TEST.STATUS=2 THENþ            CURLLOCATION="C:\PROGRA~2\Zumasys\MVDASH~1\bin\curl.exe"þ            TEST="curl via mvconnect"; GOSUB start.testþ            CMND=CURLLOCATION:' -V'þþ            CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ            CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ            CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ            CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ            BEGIN CASEþ               CASE INDEX(CMND.RESULT,"libcurl",1) AND 1þ                  TEST.MSG=CMND.RESULTþ                  TEST.STATUS=1þ               CASE OCONV(PLATFORM,"MCU")="WINDOWS"þ                  TEST.MSG=CMND.RESULTþ                  CURLLLOCATION=""þ                  TEST.STATUS=2þ               CASE 1þ                  TEST.MSG=CMND.RESULTþ                  TEST.STATUS=0þ                  CURLLOCATION=""þ            END CASEþþ            CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ            GOSUB end.testþ         ENDþþ         IF TEST.STATUS=2 THENþ            CURLLOCATION=MVDBTOOLKIT.LOCATION:'\curlexe\curl.exe'þ            TEST="curl in curlexe directory"; GOSUB start.testþ            CMND=CURLLOCATION:' -V'þþ            CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ            CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ            CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ            CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ            BEGIN CASEþ               CASE INDEX(CMND.RESULT,"libcurl",1) AND 0þ                  TEST.MSG=CMND.RESULTþ                  TEST.STATUS=1þ               CASE OCONV(PLATFORM,"MCU")="WINDOWS"þ                  TEST.MSG=CMND.RESULTþ                  CURLLLOCATION=""þ                  TEST.STATUS=2þ               CASE 1þ                  TEST.STATUS=0þ                  TEST.MSG=CMNDþ                  CURL.LOCATION=""þþ            END CASEþþ            CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ            GOSUB end.testþ         ENDþþþ         IF TEST.STATUS=2 THENþ            CURLLOCATION="c:\progra~1\git\mingw64\bin\curl.exe"þþ            TEST="curl via git"; GOSUB start.testþ            CMND=CURLLOCATION:' -V'þþ            CALL @WOBJ.RTNE(COBJ,"FROMSTRING","","{}","",RERR)þ            CALL @WOBJ.RTNE(COBJ,"SET","command",CMND,"",RERR)þ            CALL MVDBTOOLKIT.WEXECUTE(COBJ)þ            CALL @WOBJ.RTNE(COBJ,"GET","result.result",CMND.RESULT,"",RERR)þþ            BEGIN CASEþ               CASE INDEX(CMND.RESULT,"libcurl",1) AND 0þ                  TEST.MSG=CMND.RESULTþ                  TEST.STATUS=1þ               CASE 1þ                  TEST.STATUS=0þ                  TEST.MSG=CMNDþ                  CURL.LOCATION=""þþ            END CASEþþ            CONVERT CHAR(13):CHAR(10) TO '' IN TEST.MSGþ            GOSUB end.testþ         ENDþþ         IF CURLLOCATION # "" THENþ            CALL @WOBJ.RTNE(PLATFORM.OBJ,"SET","curllocation",CURLLOCATION,"",RERR)þ         ENDþþ      ENDþþþ      CALL @WOBJ.RTNE(PLATFORM.OBJ,"TOSTRING","",PLATFORM.JSON,"PRETTIFY",RERR)þ      CONVERT CHAR(13) TO @AM IN PLATFORM.JSONþ      CONVERT CHAR(10) TO '' IN PLATFORM.JSONþþ      WRITE PLATFORM.JSON ON F.CONFIG, "MV.PLATFORM.JSON"þþ      STOPþ      *þ      RETURNþ      *þprocess.error: *þ      IF RERR<1> THENþ         TEST.STATUS=-1þ         TEST.MSG=RERR<1>þ      ENDþ      RETURNþ      *þ      *þstart.test: *þ      TEST.STATUS=0þ      TEST.MSG="Success"þ      PRINT "":TEST[1,15]"L(#15)":þ      RETURNþ      *þend.test: *þ      PRINT "  ":TEST.MSG[1,50]"L(#50)":þ      PRINT " ":þ      PRE=''; AFT=''þ      BEGIN CASEþ         CASE TEST.STATUS=2; ERROR="Warning"; PRE=''; AFT=''þ         CASE TEST.STATUS; ERROR="Passed"þ         CASE 1; ERROR="Failed"; PRE=@(-13); AFT=@(-14)þ      END CASEþ      PRINT PRE:"[":þ      PRINT ERROR"L(#7)":þ      PRINT "]":AFTþ      RETURNþþþþ000CA7MVDBTOOLKIT.WEXECUTEþ0c2SUBROUTINE MVDBTOOLKIT.WEXECUTE(EOBJ)þINCLUDE MVDBTOOLKIT.WEXECUTE.INCLUDEþ**********************************************************************þ*þ* Copyright (C) 2017 Zumasys, Inc., All Rights Reservedþ*þ* Written by: Patrick Payne, Zumasysþ* Date: June 12, 2018þ* Description: Execute libraryþ*þ**********************************************************************þ*þ* EOBJþ* { "command":"COMMAND TO USE",þ*    "directory":"OPTIONAL DIRECTORY TO RUN IN",þ*    "debug":"YES OR NO",þ*    "docapture":"YES OR NO, DEFAULT YES",þ*    "returning":"YES OR NO, DEFAULT YES",þ*    "rtndata":"YES OR NO, DEFAULT NO",þ*    "passlist":"ACTUAL PASSLIST"þ*    "data": ["ARRAY OF DATA STATEMENTS"],þ*    "result: {wþ*                "result":"RESULT IF CAPTURED",þ*                "rtndata":"RESULT OF RTNDATA",þ*                "returning":"RESULT OF RETURNING",þ*                "debug":"DEBUG INFORMATION IF TURNED ON"þ*    }þ*    }þINCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþþ* With native objects we cannot do this.  We will needþ* a platform specific way of recognizing this.þ* Perhaps changes itself to WOBJ?þþIF ''="NEW" THENþ    * CREATE A NEW OBJECT AND RETURN ITþ    EJSON=\{ "command":"",\þ    EJSON:=\ "directory":"",\þ    EJSON:=\ "debug":"NO",\þ    EJSON:=\ "returning":"YES",\þ    EJSON:=\ "rtndata":"YES",\þ    EJSON:=\ "passlist":"",\þ    EJSON:=\ "data: []"\þ    EJSON:=\}\þþ    CALL @WOBJ.RTNE(EOBJ,"FROMSTRING","",EJSON,"",RERR)þ    RETURNþENDþþCALL @WOBJ.RTNE(EOBJ,"GET","command"      ,EXECUTE.COMMAND        ,"",RERR)þCALL @WOBJ.RTNE(EOBJ,"GET","directory"    ,EXECUTE.DIRECTORY      ,"",RERR)þCALL @WOBJ.RTNE(EOBJ,"GET","docapture"    ,EXECUTE.DOCAPTURE      ,"",RERR)þCALL @WOBJ.RTNE(EOBJ,"GET","returning"    ,EXECUTE.RETURNING      ,"",RERR)þCALL @WOBJ.RTNE(EOBJ,"GET","rtndata"      ,EXECUTE.RTNDATA        ,"",RERR)þCALL @WOBJ.RTNE(EOBJ,"GET","passlist"     ,EXECUTE.PASSLIST       ,"",RERR)þCALL @WOBJ.RTNE(EOBJ,"GET","debug"        ,EXECUTE.DEBUG          ,"",RERR)þIF EXECUTE.DEBUG = "" THENþ    CALL @WOBJ.RTNE(EOBJ,"GET","DEBUG",EXECUTE.DEBUG,"",RERR)þENDþþIF OCONV(EXECUTE.DEBUG[1,1],"MCU") = "Y" OR EXECUTE.DEBUG="1" THEN EXECUTE.DEBUG=1 ELSE EXECUTE.DEBUG=0þþIF EXECUTE.DEBUG THENþ    *CRT "EXECUTE.COMMAND: ":EXECUTE.COMMANDþ    *CRT "DIRECTORY      : ":EXECUTE.DIRECTORYþ    *CRT "OCAPTURE       : ":EXECUTE.OCAPTUREþ    *CRT "RETURNING      : ":EXECUTE.RETURNINGþENDþþCALL @WOBJ.RTNE(EOBJ,"TOSTRING","",TEST.JSON,"",RERR)þþþ* ERROR HANDLING TODOþþCALL @WOBJ.RTNE(EOBJ,"SET.OBJECT","result","{}","",RERR)þþCALL MVDBTOOLKIT.WPLATFORM(PLATFORMOBJ)þþCALL @WOBJ.RTNE(PLATFORMOBJ,"GET","mvtype",MV.TYPE,"",RERR)þþBEGIN CASEþ   CASE MV.TYPE='D3'þ       CALL MVDBTOOLKIT.WEXECUTE.D3(EOBJ)þ   CASE MV.TYPE='UNIDATA'þ       CALL MVDBTOOLKIT.WEXECUTE.UNIDATA(EOBJ)þ   CASE MV.TYPE="QM"þ       CALL MVDBTOOLKIT.WEXECUTE.QM(EOBJ)þ   CASE MV.TYPE="JBASE"þ       CALL MVDBTOOLKIT.WEXECUTE.JBASE(EOBJ)þ   CASE MV.TYPE="UNIVERSE"þ       CALL MVDBTOOLKIT.WEXECUTE.UNIVERSE(EOBJ)þ   CASE 1þ        CALL @WOBJ.RTNE(EOBJ,"SET","result.error","Invalid mvplatform=":MV.TYPE,"",RERR)þEND CASEþ*þ*EXECUTE CHAR(255):'k':CMND CAPTURING RESULTþ*CONVERT CHAR(0) TO '' IN RESULTþ*CONVERT CHAR(255) TO '' IN RESULTþRETURNþ000402MVDBTOOLKIT.WPLATFORM.SAVEþ0c2      SUBROUTINE MVDBTOOLKIT.WPLATFORM.SAVE(PLATFORMOBJ)þ      **********************************************************************þ      *þ      * Copyright (C) 2017 Zumasys, Inc., All Rights Reservedþ      *þ      * Written by: Patrick Payne, Zumasysþ      * Date: June 12, 2018þ      * Description: WPLATFORM OBJþ      *þ      **********************************************************************þ      *þ      *þ      * PLATFORMOBJþ      *þ      * {þ      *   "platform":" WINDOWS OR LINUX",þ      *   "mvtype"  :" JBASE, D3, UNIDATA, UNIVERSE, OPENQM",þ      *   "tmpdir"  :"tmp dir"þ      * }þþ      * nEW lINEþþ      INCLUDE MVDBTOOLKIT.WOBJ.CHOOSE.WOBJþ      þ      OPEN "MVDB.CONTROL" TO F.MVDB.CONTROL ELSEþ         PRINT "NO MVDB.CONTROL"þ         STOPþ      ENDþþ      CALL @WOBJ.RTNE(PLATFORMOBJ,"TOJSON","",OUT.JSON,"PRETTIFY",RERR)þ      þ      CALL MVDBTOOLKIT.SWAP(OUT.JSON,CHAR(13):CHAR(10),@AM)þ      þ      WRITE OUT.JSON ON F.MVDB.CONTROL, "MV.PLATFORM.JSON"þþ      RETURN000187MV.INSTALL.CFþ0c0000041MVAPPS-PRE-SCRIPTþ0c0BASICTYPE "P"þCREATE-FILE DIR MVDBTOOLKIT.BP0000D5MVAPPS-POST-SCRIPTþ0c0SELECT MVDBTOOLKIT.BP NE "_]"ýBASIC MVDBTOOLKIT.BP -I -Z2þSELECT MVDBTOOLKIT.BP NE "_]"ýCATALOG MVDBTOOLKIT.BP FORCE DIRECTþRUN MVDBTOOLKIT.BP MVDBTOOLKIT.CONFIGþ!mkdir TMPþMVDBTOOLKIT.CONFIG00004EPACKAGE.INFOþ0c0MVDBTOOLKIT Cross Platform MV toolsþ2.0.5þdbþþþMVDBTOOLKITþ228